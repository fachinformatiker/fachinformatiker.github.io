<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>How To Set Up an OpenVPN Server on Debian 9 - fachinformatiker.app</title><meta name="description" content="Neues zum Thema Technik, Medien, etc.
Gerne bringe ich dir auch in meinen Tutorials, schriftlich wie auch audiovisuell, neues bei und erweitere dein Wissen."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-set-up-an-openvpn-server-on-debian-9.html"><link rel="amphtml" href="https://fachinformatiker.github.io/fachinformatiker.github.io/amp/how-to-set-up-an-openvpn-server-on-debian-9.html"><link rel="alternate" type="application/atom+xml" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.json"><meta property="og:title" content="How To Set Up an OpenVPN Server on Debian 9"><meta property="og:site_name" content="fachinformatiker.app"><meta property="og:description" content="Neues zum Thema Technik, Medien, etc.
Gerne bringe ich dir auch in meinen Tutorials, schriftlich wie auch audiovisuell, neues bei und erweitere dein Wissen."><meta property="og:url" content="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-set-up-an-openvpn-server-on-debian-9.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@psvisualdesign"><meta name="twitter:title" content="How To Set Up an OpenVPN Server on Debian 9"><meta name="twitter:description" content="Neues zum Thema Technik, Medien, etc.
Gerne bringe ich dir auch in meinen Tutorials, schriftlich wie auch audiovisuell, neues bei und erweitere dein Wissen."><style>:root {
                --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
                --heading-font: var(--body-font);
                --post-entry-font: var(--body-font);
                --logo-font: var(--body-font);
                --menu-font: var(--body-font)
            }</style><link rel="stylesheet" href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/css/style.css?v=873a5ca0069471e5b0a81f6a9be47718"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-set-up-an-openvpn-server-on-debian-9.html"},"headline":"How To Set Up an OpenVPN Server on Debian 9","datePublished":"2020-02-23T12:46","dateModified":"2020-05-12T08:44","description":"<p>Whether you want to access the Internet safely and securely while connected on an untrusty public Wi-Fi network, bypass Geo-restricted content or allow your coworkers to connect securely to your company network when working remotely, using a VPN is the best solution.</p>\n<p>A VPN allows you to connect to remote VPN servers, making your connection encrypted and secure and surf the web anonymously by keeping your traffic data private.<span id=\"ezoic-pub-ad-placeholder-158\" class=\"ezoic-adpicker-ad\"></span></p>\n<p>There are many commercial VPN providers you can choose from, but you can never be truly sure that the provider is not logging your activity. The safest option is to set up your own VPN server.<span id=\"ezoic-pub-ad-placeholder-138\" class=\"ezoic-adpicker-ad\"></span></p>\n<p>This tutorial will explain how to install and configure OpenVPN on Debian 9. We will also show you how to generate clients certificates and create configuration files</p>\n<p>OpenVPN is a fully featured, open-source Secure Socket Layer (SSL) VPN solution. It implements OSI layer 2 or 3 secure network extension using the SSL/TLS protocol.<br />\n","author":{"@type":"Person","name":"Patrick Szalewicz"},"publisher":{"@type":"Organization","name":"Patrick Szalewicz"}}</script><script src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/ls.object-fit.min.js?v=cdedd9262bb7b299d0ebe1deaea5b924"></script><script async src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/lazysizes.min.js?v=d8513e7860f747ccf55c52308943beab"></script></head><body><header class="topbar" id="js-header"><div class="topbar__inner"><a class="logo" href="https://fachinformatiker.github.io/fachinformatiker.github.io/">fachinformatiker.app</a></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2020-05-12T09:14">12 May 2020</time></div><div class="infobar__search"><form action="https://fachinformatiker.github.io/fachinformatiker.github.io/search.html"><input type="search" name="q" placeholder=" search..."> <button type="submit" aria-label="Search"><svg width="15px" height="14px"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#search"/></svg></button></form></div></div><main class="main"><article class="post"><header class="u-header post__header"><h1>How To Set Up an OpenVPN Server on Debian 9</h1><div class="u-header__meta u-small"><div><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" title="Patrick Szalewicz">Patrick Szalewicz</a> <time datetime="2020-02-23T12:46">23 February 2020 </time><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/homelab/" class="u-tag u-tag--1">Homelab</a></div></div></header><div class="post__entry u-inner"><p>Whether you want to access the Internet safely and securely while connected on an untrusty public Wi-Fi network, bypass Geo-restricted content or allow your coworkers to connect securely to your company network when working remotely, using a VPN is the best solution.</p><p>A VPN allows you to connect to remote VPN servers, making your connection encrypted and secure and surf the web anonymously by keeping your traffic data private.<span id="ezoic-pub-ad-placeholder-158" class="ezoic-adpicker-ad"></span></p><p>There are many commercial VPN providers you can choose from, but you can never be truly sure that the provider is not logging your activity. The safest option is to set up your own VPN server.<span id="ezoic-pub-ad-placeholder-138" class="ezoic-adpicker-ad"></span></p><p>This tutorial will explain how to install and configure OpenVPN on Debian 9. We will also show you how to generate clients certificates and create configuration files</p><p>OpenVPN is a fully featured, open-source Secure Socket Layer (SSL) VPN solution. It implements OSI layer 2 or 3 secure network extension using the SSL/TLS protocol.<br><span id="ezoic-pub-ad-placeholder-139" class="ezoic-adpicker-ad"></span></p><h2 id="prerequisites">Prerequisites</h2><p>To complete this tutorial, you will need:<span id="ezoic-pub-ad-placeholder-156" class="ezoic-adpicker-ad"></span></p><ul><li>Sudo access to a Debian 9 server with a basic UFW firewall configured on which we will install the OpenVPN service.</li><li>Separate dedicated machine to serve as your CA (certificate authority). If you don't want to use a dedicated machine for your CA, you can build the CA on your OpenVPN server or your local machine. Once you are done building the CA it's recommended to move the CA directory somewhere secure or offline.</li></ul><p><span id="ezoic-pub-ad-placeholder-159" class="ezoic-adpicker-ad"></span>This tutorial assumes that the CA is on a separate Debian 9 machine. The same steps (with small modifications) will apply if you're using your server as a CA.<span id="ezoic-pub-ad-placeholder-140" class="ezoic-adpicker-ad"></span></p><p>We are using a separate CA machine to prevent attackers to infiltrate the server. If an attacker manages to access the CA private key they could use it to sign new certificates, which will give them access to the VPN server.</p><h2 id="building-ca-with-easyrsa">Building CA with EasyRSA</h2><p>The first step is to build a Public Key Infrastructure (<a href="https://en.wikipedia.org/wiki/Public_key_infrastructure">PKI</a>) including the following:</p><ul><li>A Certificate Authority (CA) certificate and private key.</li><li>A separate certificate and private key pair for the server issued by our CA.</li><li>A separate certificate and private key pair for each client issued by our CA.</li></ul><p>As mentioned in the prerequisites for security reasons, we'll build the CA on a standalone machine.</p><p>We will use a CLI utility named EasyRSA to create CA, generate certificate requests and sign certificates.</p><p>Perform the following steps on your <strong>CA machine</strong>:<span id="ezoic-pub-ad-placeholder-142" class="ezoic-adpicker-ad"></span></p><ol><li>Start by downloading the latest release of EasyRSA from the project <a href="https://github.com/OpenVPN/easy-rsa">Github repository</a> with the following wget command:<pre class="terminal secondary-terminal"><code>cd &amp;&amp; wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.6/EasyRSA-unix-v3.0.6.tgz</code></pre></li><li>Once the download is complete extract the archive:<pre class="terminal secondary-terminal"><code>tar xzf EasyRSA-unix-v3.0.6.tgz</code></pre></li><li>Navigate to the EasyRSA directory and create a configuration file named <code>vars</code> by copying the <code>vars.example</code> file:<pre class="terminal secondary-terminal"><code>cd ~/EasyRSA-v3.0.6/</code><code>cp vars.example vars</code></pre></li><li>Open the file and uncomment and update the following entries to match your information.<pre class="terminal secondary-terminal"><code>nano ~/EasyRSA-v3.0.6/vars</code></pre><div class="code-label">~/EasyRSA-v3.0.6/vars</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="na">set_var EASYRSA_REQ_COUNTRY    "US"</span>
<span class="na">set_var EASYRSA_REQ_PROVINCE   "Pennsylvania"</span>
<span class="na">set_var EASYRSA_REQ_CITY       "Pittsburgh"</span>
<span class="na">set_var EASYRSA_REQ_ORG        "Linuxize"</span>
<span class="na">set_var EASYRSA_REQ_EMAIL      "admin@linuxize.com"</span>
<span class="na">set_var EASYRSA_REQ_OU         "Community"</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="set_var EASYRSA_REQ_COUNTRY &quot;US&quot; set_var EASYRSA_REQ_PROVINCE &quot;Pennsylvania&quot; set_var EASYRSA_REQ_CITY &quot;Pittsburgh&quot; set_var EASYRSA_REQ_ORG &quot;Linuxize&quot; set_var EASYRSA_REQ_EMAIL &quot;admin@linuxize.com&quot; set_var EASYRSA_REQ_OU &quot;Community&quot;">Copy</span></p></div></li><li>Before generating a CA keypair first you need to initialize a new PKI with:<pre class="terminal secondary-terminal"><code>./easyrsa init-pki</code></pre><pre><code class="language-output" data-lang="output">init-pki complete; you may now create a CA or requests.
Your newly created PKI dir is: /home/causer/EasyRSA-v3.0.6/pki</code></pre></li><li>The next step is to build the CA:<pre class="terminal secondary-terminal"><code>./easyrsa build-ca</code></pre><p><em>If you don’t want to be prompted for a password each time you sign your certificates, run the <code>build-ca</code> command using the <code>nopass</code> option: <code>./easyrsa build-ca nopass</code>.</em></p><pre><code class="language-output" data-lang="output">...
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
-----
...
-----
Common Name (eg: your user, host, or server name) [Easy-RSA CA]:

CA creation complete and you may now import and sign cert requests.
Your new CA certificate file for publishing is at:
/home/causer/EasyRSA-v3.0.6/pki/ca.crt</code></pre><p>You’ll be asked to set a password for the CA key and enter a common name for your CA.</p><p>Once completed, the script will create two files — CA public certificate <code>ca.crt</code> and CA private key <code>ca.key</code>.</p><p>We will use the Certificate Authority (CA) files to sign certificate requests for our OpenVPN server and clients.</p></li></ol><div class="w-full flex justify-center content-center"><div class="w-full relative"></div></div><h2 id="installing-openvpn-and-easyrsa">Installing OpenVPN and EasyRSA</h2><p>The next step is to install the OpenVPN package which is available in Debian's repositories and download the latest version of EasyRSA on the OpenVPN server.<span id="ezoic-pub-ad-placeholder-160" class="ezoic-adpicker-ad"></span></p><p>The following steps are performed on the <strong>OpenVPN server</strong>.</p><ol><li>OpenVPN installation is pretty straightforward, just run the following commands on the <strong>OpenVPN server</strong>:<pre class="terminal"><code>sudo apt update</code><code>sudo apt install openvpn</code></pre></li><li>Download the latest release of EasyRSA:<pre class="terminal"><code>cd &amp;&amp; wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.6/EasyRSA-unix-v3.0.6.tgz</code></pre><p>Once the download is completed type the following command to extract the archive:</p><pre class="terminal"><code>tar xzf EasyRSA-unix-v3.0.6.tgz</code></pre><p>Although we have already initialized a PKI on the CA machine, we also need to create a new PKI on the OpenVPN server. To do so, use the same commands as before:</p><pre class="terminal"><code>cd ~/EasyRSA-v3.0.6/</code><code>./easyrsa init-pki</code></pre><p>If you still wonder why we need two EasyRSA installations, it is because we will use this EasyRSA instance to generate certificate requests which will be signed using the EasyRSA instance on the <strong>CA machine</strong>.</p><p>It may sound complicated, and little confusing but once you read the whole tutorial you'll see that it really isn't complicated.</p></li></ol><h2 id="creating-diffie-hellman-and-hmac-keys">Creating Diffie-Hellman and HMAC keys</h2><p>In this section, we will generate a strong Diffie-Hellman key which will be used during the key exchange and a HMAC signature file to add an additional layer of security to the connection.</p><ol><li>First navigate to the EasyRSA directory on your <strong>OpenVPN server</strong>.<pre class="terminal"><code>cd ~/EasyRSA-v3.0.6/</code></pre></li><li>Generate a Diffie-Hellman key:<pre class="terminal"><code>./easyrsa gen-dh</code></pre><p>The script will generate 2048-bit long DH parameters. Depending on your system resources, the generation may take some time. Once completed the following message will be printed on your screen:</p><pre><code>DH parameters of size 2048 created at /home/serveruser/EasyRSA-v3.0.6/pki/dh.pem</code></pre><p>Copy the <code>dh.pem</code> file to the <code>/etc/openvpn</code> directory:</p><pre class="terminal"><code>sudo cp ~/EasyRSA-v3.0.6/pki/dh.pem /etc/openvpn/</code></pre></li><li>Generate a HMAC signature:<pre class="terminal"><code>openvpn --genkey --secret ta.key</code></pre><p>Once done copy the <code>ta.key</code> file to the <code>/etc/openvpn</code> directory:</p><pre class="terminal"><code>sudo cp ~/EasyRSA-v3.0.6/ta.key /etc/openvpn/</code></pre></li></ol><h2 id="creating-server-certificate-and-private-key">Creating Server Certificate and Private Key</h2><p>This section describes how to generate a private key and certificate request for the OpenVPN server.<span id="ezoic-pub-ad-placeholder-143" class="ezoic-adpicker-ad"></span></p><ol><li>Navigate to the EasyRSA directory on your <strong>OpenVPN server</strong> and generate a new private key for the server and a certificate request file:<pre class="terminal"><code>cd ~/EasyRSA-v3.0.6/</code><code>./easyrsa gen-req server1 nopass</code></pre><p>We are using the <code>nopass</code> argument because we want to start the OpenVPN server without a password input. Also in this example, we are using <code>server1</code> as a server name (entity) identifier. If you choose a different name for your server don't forget to adjust the instructions below where the server name is used.</p><p>The command will create two files, a private key (<code>server1.key</code>) and a certificate request file (<code>server1.req</code>).</p><pre><code class="language-output" data-lang="output">-----
Common Name (eg: your user, host, or server name) [server1]:

Keypair and certificate request completed. Your files are:
req: /home/serveruser/EasyRSA-v3.0.6/pki/reqs/server1.req
key: /home/serveruser/EasyRSA-v3.0.6/pki/private/server1.key</code></pre></li><li>Copy the private key to the <code>/etc/openvpn</code> directory:<pre class="terminal"><code>sudo cp ~/EasyRSA-v3.0.6/pki/private/server1.key /etc/openvpn/</code></pre></li><li>Transfer the certificate request file to your CA machine:<pre class="terminal"><code>scp ~/EasyRSA-v3.0.6/pki/reqs/server1.req causer@your_ca_ip:/tmp</code></pre><p>In this example we are using <a href="https://linuxize.com/post/how-to-use-scp-command-to-securely-transfer-files/"><code>scp</code></a> to transfer the file, you can also use <a href="https://linuxize.com/post/how-to-use-rsync-for-local-and-remote-data-transfer-and-synchronization/"><code>rsync</code></a> over ssh or any other secure method.</p></li><li>Login to your <strong>CA machine</strong>, switch to the EasyRSA directory and import the certificate request file:<pre class="terminal secondary-terminal"><code>cd ~/EasyRSA-v3.0.6</code><code>./easyrsa import-req /tmp/server1.req server1</code></pre><p>The first argument is the path to the certificate request file and the second one is the server short (entity) name. In our case the server name is <code>server1</code>.</p><pre><code class="language-output" data-lang="output">The request has been successfully imported with a short name of: server1
You may now use this name to perform signing operations on this request.</code></pre><p>This command just copies the request file into the <code>pki/reqs</code> directory.</p></li><li>While still in the EasyRSA directory on <strong>CA machine</strong> run the following command to sign the request:<pre class="terminal secondary-terminal"><code>cd ~/EasyRSA-v3.0.6</code><code>./easyrsa sign-req server server1</code></pre><p>The first argument can either be <code>server</code> or <code>client</code> and the second one is the server short (entity) name.</p><p>You’ll be prompted to verify that the request comes from a trusted source. Type <code>yes</code> and press <code>enter</code> to confirm:</p><pre><code class="language-output" data-lang="output">You are about to sign the following certificate.
Please check over the details shown below for accuracy. Note that this request
has not been cryptographically verified. Please be sure it came from a trusted
source or that you have verified the request checksum with the sender.

Request subject, to be signed as a server certificate for 1080 days:

subject=
    commonName                = server1

Type the word 'yes' to continue, or any other input to abort.
Confirm request details: yes
...</code></pre><p>If your CA key is password protected, you’ll be prompted to enter the password. Once verified the script will generate the SSL certificate and print the full path to it.</p><pre><code class="language-output" data-lang="output">...
Certificate is to be certified until Sep 17 10:54:48 2021 GMT (1080 days)

Write out database with 1 new entries
Data Base Updated

Certificate created at: /home/causer/EasyRSA-v3.0.6/pki/issued/server1.crt</code></pre></li><li>Next step is to transfer the signed certificate <code>server1.crt</code> and <code>ca.crt</code> files back to your OpenVPN server. Again you can use <code>scp</code>, <code>rsync</code> or any other secure method:<pre class="terminal secondary-terminal"><code>scp ~/EasyRSA-v3.0.6/pki/issued/server1.crt serveruser@your_server_ip:/tmp</code><code>scp ~/EasyRSA-v3.0.6/pki/ca.crt serveruser@your_server_ip:/tmp</code></pre></li><li>Login to your <strong>OpenVPN server</strong>, and move the <code>server1.crt</code> and <code>ca.crt</code> files into the <code>/etc/openvpn/</code> directory:<pre class="terminal"><code>sudo mv /tmp/{server1,ca}.crt /etc/openvpn/</code></pre></li></ol><p><span id="ezoic-pub-ad-placeholder-161" class="ezoic-adpicker-ad"></span>Upon completing the steps outlined in this section, you should have the following new files on your <strong>OpenVPN server</strong>:</p><ul><li><code>/etc/openvpn/ca.crt</code></li><li><code>/etc/openvpn/dh.pem</code></li><li><code>/etc/openvpn/ta.key</code></li><li><code>/etc/openvpn/server1.crt</code></li><li><code>/etc/openvpn/server1.key</code></li></ul><h2 id="configuring-the-openvpn-service">Configuring the OpenVPN Service</h2><p>Now that you have the server certificate signed by your CA and transferred to your <strong>OpenVPN server</strong>, it's time to configure the OpenVPN service.</p><p>We will use the sample configuration file provided with OpenVPN installation package as a starting point and then add our own custom configuration options to it.<span id="ezoic-pub-ad-placeholder-144" class="ezoic-adpicker-ad"></span></p><p>Start by extracting the configuration file to the <code>/etc/openvpn/</code> directory:</p><pre class="terminal"><code>sudo sh -c "gunzip -c /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz &gt; /etc/openvpn/server1.conf"</code></pre><p>Open the file with your favorite text editor:<span id="ezoic-pub-ad-placeholder-157" class="ezoic-adpicker-ad"></span></p><pre class="terminal"><code>sudo nano /etc/openvpn/server1.conf</code></pre><ul><li>Find the Certificate, Key and DH parameters directives and change the file names:<div class="code-label">/etc/openvpn/server1.conf</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="na">cert server1.crt</span>
<span class="na">key server1.key </span>

<span class="na">dh dh.pem</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="cert server1.crt key server1.key dh dh.pem">Copy</span></p></div></li><li>To redirect the clients traffic through the VPN find and uncomment the <code>redirect-gateway</code> and <code>dhcp-option</code> options:<div class="code-label">/etc/openvpn/server1.conf</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="na">push "redirect-gateway def1 bypass-dhcp"</span>

<span class="na">push "dhcp-option DNS 208.67.222.222"</span>
<span class="na">push "dhcp-option DNS 208.67.220.220"</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="push &quot;redirect-gateway def1 bypass-dhcp&quot; push &quot;dhcp-option DNS 208.67.222.222&quot; push &quot;dhcp-option DNS 208.67.220.220&quot;">Copy</span></p></div><p>By default OpenDNS resolvers are used. You can change it and use CloudFlare, Google or any other DNS resolvers you want.</p></li><li>Find the <code>user</code> and <code>group</code> directives and uncomment these settings by removing the “<code>;</code>” at the beginning of each line:<div class="code-label">/etc/openvpn/server1.conf</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="na">user nobody</span>
<span class="na">group nogroup</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="user nobody group nogroup">Copy</span></p></div></li><li>Append the following line at the end of the file. This directive will change the message authentication algorithm (HMAC) from SHA1 to SHA256<div class="code-label">/etc/openvpn/server1.conf</div><div class="highlight"><pre class="chroma"><code><span class="na">auth SHA256</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="auth SHA256">Copy</span></p></div></li></ul><p>Once you are done, the server configuration file (excluding comments) should look something like this:<span id="ezoic-pub-ad-placeholder-145" class="ezoic-adpicker-ad"></span></p><div class="code-label">/etc/openvpn/server1.conf</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="na">port 1194</span>
<span class="na">proto udp</span>
<span class="na">dev tun</span>
<span class="na">ca ca.crt</span>
<span class="na">cert server1.crt</span>
<span class="na">key server1.key  # This file should be kept secret</span>
<span class="na">dh dh.pem</span>
<span class="na">server 10.8.0.0 255.255.255.0</span>
<span class="na">ifconfig-pool-persist /var/log/openvpn/ipp.txt</span>
<span class="na">push "redirect-gateway def1 bypass-dhcp"</span>
<span class="na">push "dhcp-option DNS 208.67.222.222"</span>
<span class="na">push "dhcp-option DNS 208.67.220.220"</span>
<span class="na">keepalive 10 120</span>
<span class="na">tls-auth ta.key 0 # This file is secret</span>
<span class="na">cipher AES-256-CBC</span>
<span class="na">user nobody</span>
<span class="na">group nogroup</span>
<span class="na">persist-key</span>
<span class="na">persist-tun</span>
<span class="na">status /var/log/openvpn/openvpn-status.log</span>
<span class="na">verb 3</span>
<span class="na">explicit-exit-notify 1</span>
<span class="na">auth SHA256</span>
</code></pre><p><span class="code-copy button main small" data-clipboard-text="port 1194 proto udp dev tun ca ca.crt cert server1.crt key server1.key # This file should be kept secret dh dh.pem server 10.8.0.0 255.255.255.0 ifconfig-pool-persist /var/log/openvpn/ipp.txt push &quot;redirect-gateway def1 bypass-dhcp&quot; push &quot;dhcp-option DNS 208.67.222.222&quot; push &quot;dhcp-option DNS 208.67.220.220&quot; keepalive 10 120 tls-auth ta.key 0 # This file is secret cipher AES-256-CBC user nobody group nogroup persist-key persist-tun status /var/log/openvpn/openvpn-status.log verb 3 explicit-exit-notify 1 auth SHA256 ">Copy</span></p></div><h2 id="starting-openvpn-service">Starting OpenVPN Service</h2><p>In this tutorial, we've used <code>server1.conf</code> as a configuration file. To start the OpenVPN service with this configuration we need to specify the configuration file name after the systemd unit file name:</p><p>On your <strong>OpenVPN server</strong> run the following command to start the OpenVPN service:</p><pre class="terminal"><code>sudo systemctl start openvpn@server1</code></pre><p>Verify whether the service has started successfully by typing:</p><pre class="terminal"><code>sudo systemctl status openvpn@server1</code></pre><p>If the service is active and running, the output will look something like this:<span id="ezoic-pub-ad-placeholder-146" class="ezoic-adpicker-ad"></span></p><pre><code class="language-output" data-lang="output">● openvpn@server1.service - OpenVPN connection to server1
   Loaded: loaded (/lib/systemd/system/openvpn@.service; disabled; vendor preset: enabled)
   Active: active (running) since Tue 2019-03-19 03:49:53 PDT; 3s ago
     Docs: man:openvpn(8)
           https://community.openvpn.net/openvpn/wiki/Openvpn23ManPage
           https://community.openvpn.net/openvpn/wiki/HOWTO
  Process: 1722 ExecStart=/usr/sbin/openvpn --daemon ovpn-server1 --status /run/openvpn/server1.status 10 --cd /etc/openvpn --config /etc/openvpn/server1.conf --writepid /run/openvpn/server1.pid (code=exited, status=0/SUCCESS)
 Main PID: 1723 (openvpn)
    Tasks: 1 (limit: 4915)
   CGroup: /system.slice/system-openvpn.slice/openvpn@server1.service
           └─1723 /usr/sbin/openvpn --daemon ovpn-server1 --status /run/openvpn/server1.status 10 --cd /etc/openvpn --config /etc/openvpn/server1.conf --writepid /run/openvpn/server1.pid
</code></pre><p>Enable the service to automatically start on boot with:</p><pre class="terminal"><code>sudo systemctl enable openvpn@server1</code></pre><pre><code class="language-output" data-lang="output">Created symlink /etc/systemd/system/multi-user.target.wants/openvpn@server1.service → /lib/systemd/system/openvpn@.service.
</code></pre><div class="my-6 bg-yellow-100 border-l-4 border-yellow-400 dark:bg-gray-800 dark:border-0 dark:text-yellow-200 note p-6"><div class="flex"><div class="w-full text-sm font-sans">If the OpenVPN service fails to start check the logs with <code>sudo journalctl -u openvpn@server1</code></div></div></div><p>When starting, the OpenVPN Server creates a tun device <code>tun0</code>. To verify it use the following ip command:</p><pre class="terminal"><code>ip a show tun0</code></pre><p>The output should look something like this:</p><pre><code class="language-output" data-lang="output">3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100
    link/none 
    inet 10.8.0.1 peer 10.8.0.2/32 scope global tun0
       valid_lft forever preferred_lft forever
</code></pre><p>At this point, your OpenVPN server is configured and running properly.</p><h2 id="firewall-and-server-networking-configuration">Firewall and Server Networking Configuration</h2><p>In order to forward network packets properly, we need to enable IP forwarding.<span id="ezoic-pub-ad-placeholder-147" class="ezoic-adpicker-ad"></span></p><p>The following steps are performed on the <strong>OpenVPN server</strong>.</p><p>Open the <code>/etc/sysctl.conf</code> file and add or uncomment the line which reads <code>net.ipv4.ip_forward = 0</code>:</p><pre class="terminal"><code>sudo nano /etc/sysctl.conf</code></pre><div class="code-label">/etc/sysctl.conf</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="c1"># Uncomment the next line to enable packet forwarding for IPv4</span>
<span class="na">net.ipv4.ip_forward</span><span class="o">=</span><span class="s">1</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="# Uncomment the next line to enable packet forwarding for IPv4 net.ipv4.ip_forward=1">Copy</span></p></div><p>Once you are finished, save and close the file.</p><p>Apply the new settings by running the following command:</p><pre class="terminal"><code>sudo sysctl -p</code></pre><pre><code class="language-output" data-lang="output">net.ipv4.ip_forward = 1
</code></pre><p>If you followed the prerequisites, you should already have a UFW firewall running on your server.</p><p>Now we need to add firewall rules to enable masquerading. This will allow traffic to leave the VPN, giving your VPN clients access to the Internet.</p><p>Before adding the rules you need to know the public network interface of your Debian OpenVPN Server. You can easily find the interface by running the following command:<span id="ezoic-pub-ad-placeholder-149" class="ezoic-adpicker-ad"></span></p><pre class="terminal"><code>ip -o -4 route show to default | awk '{print $5}'</code></pre><p>In our case, the interface is named <code>eth0</code> as shown on the output below. Your interface will probably have a different name.</p><pre><code class="language-output" data-lang="output">eth0
</code></pre><p>By default, when using UFW the forwarded packets are dropped. We'll need to change that and instruct our firewall to allow forwarded packets.</p><p>Open the UFW configuration file, locate the <code>DEFAULT_FORWARD_POLICY</code> key and change the value from <code>DROP</code> to <code>ACCEPT</code>:</p><pre class="terminal"><code>sudo nano /etc/default/ufw</code></pre><div class="code-label">/etc/default/ufw</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="na">...</span>
<span class="c1"># Set the default forward policy to ACCEPT, DROP or REJECT.  Please note that</span>
<span class="c1"># if you change this you will most likely want to adjust your rules</span>
<span class="hl"><span class="na">DEFAULT_FORWARD_POLICY</span><span class="o">=</span><span class="s">"ACCEPT"</span>
</span><span class="na">...</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="... # Set the default forward policy to ACCEPT, DROP or REJECT. Please note that # if you change this you will most likely want to adjust your rules DEFAULT_FORWARD_POLICY=&quot;ACCEPT&quot; ...">Copy</span></p></div><p>Next, we need to set the default policy for the <code>POSTROUTING</code> chain in the nat table and set the masquerade rule.</p><p>To do so, open the <code>/etc/ufw/before.rules</code> file and append the lines highlighted in yellow as shown below.</p><pre class="terminal"><code>sudo nano /etc/ufw/before.rules</code></pre><p>Don't forget to replace <code>eth0</code> in the <code>-A POSTROUTING</code> line to match the name of public network interface you found in the previous command. Paste the lines after the last line starting with <code>COMMIT</code>.</p><div class="code-label">/etc/ufw/before.rules</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="na">...</span>
<span class="c1"># don't delete the 'COMMIT' line or these rules won't be processed</span>
<span class="na">COMMIT</span>

<span class="hl"><span class="c1">#NAT table rules</span>
</span><span class="hl"><span class="na">*nat</span>
</span><span class="hl"><span class="na">:POSTROUTING ACCEPT [0:0]</span>
</span>
<span class="hl"><span class="c1"># Forward traffic through eth0 - Change to public network interface</span>
</span><span class="hl"><span class="na">-A POSTROUTING -s 10.8.0.0/16 -o eth0 -j MASQUERADE</span>
</span>
<span class="hl"><span class="c1"># don't delete the 'COMMIT' line or these rules won't be processed</span>
</span><span class="hl"><span class="na">COMMIT</span></span></code></pre><p><span class="code-copy button main small" data-clipboard-text="... # don't delete the 'COMMIT' line or these rules won't be processed COMMIT #NAT table rules *nat :POSTROUTING ACCEPT [0:0] # Forward traffic through eth0 - Change to public network interface -A POSTROUTING -s 10.8.0.0/16 -o eth0 -j MASQUERADE # don't delete the 'COMMIT' line or these rules won't be processed COMMIT">Copy</span></p></div><p>When you are done, save and close the file.</p><p>We also need to open UDP traffic on port <code>1194</code> which is the default OpenVPN port. To do so, run the following command:<span id="ezoic-pub-ad-placeholder-148" class="ezoic-adpicker-ad"></span></p><pre class="terminal"><code>sudo ufw allow 1194/udp</code></pre><p>In case you forgot to open the SSH port, to avoid being locked out, run the following command to open the port:</p><pre class="terminal"><code>sudo ufw allow OpenSSH</code></pre><p>Finally reload the UFW rules by disabling and re-enabling UFW:</p><pre class="terminal"><code>sudo ufw disable</code><code>sudo ufw enable</code></pre><p>To verify the changes run the following command to list the POSTROUTING rules:</p><pre class="terminal"><code>sudo iptables -nvL POSTROUTING -t nat</code></pre><pre><code class="language-output" data-lang="output">Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 MASQUERADE  all  --  *      eth0    10.8.0.0/16          0.0.0.0/0  
</code></pre><h2 id="creating-the-client-configuration-infrastructure">Creating the Client Configuration Infrastructure</h2><p>In this tutorial, we'll create a separate SSL certificate and generate a different configuration file for each VPN client.</p><p>The client private key and certificate request can be generated either on the client machine or on the server. For simplicity, we will generate the certificate request on the server and then send it to the CA to be signed.</p><p>The whole process of generating the client certificate and configuration file is as follows:</p><ol><li>Generate a private key and certificate request on the OpenVPN server.</li><li>Send the request to the CA machine to be signed.</li><li>Copy the signed SSL certificate to the OpenVPN server and generate a configuration file.</li><li>Send the configuration file to the VPN client's machine.</li></ol><p>Start by creating a set of directories to store the clients files:</p><pre class="terminal"><code>mkdir -p ~/openvpn-clients/{configs,base,files}</code></pre><ul><li><code>base</code> directory will store the base files and configuration that will be shared across all client files.</li><li><code>configs</code> directory will store the generated client configuration.</li><li><code>files</code> directory will store client-specific certificate/key pair.</li></ul><p>Copy the <code>ca.crt</code> and <code>ta.key</code> files to the <code>~/openvpn-clients/base</code> directory:</p><pre class="terminal"><code>cp ~/EasyRSA-v3.0.6/ta.key ~/openvpn-clients/base/</code><code>cp /etc/openvpn/ca.crt ~/openvpn-clients/base/</code></pre><p>Next copy the sample VPN client configuration file into the client-<code>~/openvpn-clients/base</code> directory. We will use this file as a base configuration:</p><pre class="terminal"><code>cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/openvpn-clients/base/</code></pre><p>Now we need to edit the file to match our server settings and configuration. Open the configuration file with your text editor:</p><pre class="terminal"><code>nano ~/openvpn-clients/base/client.conf</code></pre><ul><li>Find the remote directive and change the default placeholder with the public IP address of your OpenVPN server:<div class="code-label">~/openvpn-clients/base/client.conf</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="c1"># The hostname/IP and port of the server.</span>
<span class="c1"># You can have multiple remote entries</span>
<span class="c1"># to load balance between the servers.</span>
<span class="na">remote YOUR_SERVER_IP 1194</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="# The hostname/IP and port of the server. # You can have multiple remote entries # to load balance between the servers. remote YOUR_SERVER_IP 1194">Copy</span></p></div></li><li>Locate and comment the <code>ca</code>, <code>cert</code>, and <code>key</code> directives. The certs and keys will be added within the configuration file:<div class="code-label">~/openvpn-clients/base/client.conf</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="c1"># SSL/TLS parms.</span>
<span class="c1"># See the server config file for more</span>
<span class="c1"># description.  It's best to use</span>
<span class="c1"># a separate .crt/.key file pair</span>
<span class="c1"># for each client.  A single ca</span>
<span class="c1"># file can be used for all clients.</span>
<span class="c1"># ca ca.crt</span>
<span class="c1"># cert client.crt</span>
<span class="c1"># key client.key</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="# SSL/TLS parms. # See the server config file for more # description. It's best to use # a separate .crt/.key file pair # for each client. A single ca # file can be used for all clients. # ca ca.crt # cert client.crt # key client.key">Copy</span></p></div></li><li>Append the following line at the end of the file to match the server settings:<div class="code-label">~/openvpn-clients/base/client.conf</div><div class="highlight"><pre class="chroma"><code><span class="na">auth SHA256</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="auth SHA256">Copy</span></p></div></li></ul><p>Once you are done, the server configuration file should look something like this:</p><div class="code-label">~/openvpn-clients/base/client.conf</div><div class="highlight"><pre class="chroma"><code class="language-cfg" data-lang="cfg"><span class="na">client</span>
<span class="na">dev tun</span>
<span class="na">proto udp</span>
<span class="na">remote YOUR_SERVER_IP 1194</span>
<span class="na">resolv-retry infinite</span>
<span class="na">nobind</span>
<span class="na">persist-key</span>
<span class="na">persist-tun</span>
<span class="na">remote-cert-tls server</span>
<span class="na">cipher AES-256-CBC</span>
<span class="na">verb 3</span>
<span class="na">auth SHA256</span>
<span class="na">key-direction 1</span>
</code></pre><p><span class="code-copy button main small" data-clipboard-text="client dev tun proto udp remote YOUR_SERVER_IP 1194 resolv-retry infinite nobind persist-key persist-tun remote-cert-tls server cipher AES-256-CBC verb 3 auth SHA256 key-direction 1 ">Copy</span></p></div><p>Next, create a simple bash script that will merge the base configuration and files with the client certificate and key, and store the generated configuration in the <code>~/openvpn-clients/configs</code> directory.</p><p>Open your text editor and create the following script:</p><pre class="terminal"><code>nano ~/openvpn-clients/gen_config.sh</code></pre><div class="code-label">~/openvpn-clients/gen_config.sh</div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="cp">#!/bin/bash
</span>
<span class="nv">FILES_DIR</span><span class="o">=</span><span class="nv">$HOME</span>/openvpn-clients/files
<span class="nv">BASE_DIR</span><span class="o">=</span><span class="nv">$HOME</span>/openvpn-clients/base
<span class="nv">CONFIGS_DIR</span><span class="o">=</span><span class="nv">$HOME</span>/openvpn-clients/configs

<span class="nv">BASE_CONF</span><span class="o">=</span><span class="si">${</span><span class="nv">BASE_DIR</span><span class="si">}</span>/client.conf
<span class="nv">CA_FILE</span><span class="o">=</span><span class="si">${</span><span class="nv">BASE_DIR</span><span class="si">}</span>/ca.crt
<span class="nv">TA_FILE</span><span class="o">=</span><span class="si">${</span><span class="nv">BASE_DIR</span><span class="si">}</span>/ta.key

<span class="nv">CLIENT_CERT</span><span class="o">=</span><span class="si">${</span><span class="nv">FILES_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">1</span><span class="si">}</span>.crt
<span class="nv">CLIENT_KEY</span><span class="o">=</span><span class="si">${</span><span class="nv">FILES_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">1</span><span class="si">}</span>.key

<span class="c1"># Test for files</span>
<span class="k">for</span> i in <span class="s2">"</span><span class="nv">$BASE_CONF</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$CA_FILE</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$TA_FILE</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$CLIENT_CERT</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$CLIENT_KEY</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span>
    <span class="k">if</span> <span class="o">[</span><span class="o">[</span> ! -f <span class="nv">$i</span> <span class="o">]</span><span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="s2"> The file </span><span class="nv">$i</span><span class="s2"> does not exist</span><span class="s2">"</span>
        <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">fi</span>

    <span class="k">if</span> <span class="o">[</span><span class="o">[</span> ! -r <span class="nv">$i</span> <span class="o">]</span><span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="s2"> The file </span><span class="nv">$i</span><span class="s2"> is not readable.</span><span class="s2">"</span>
        <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">fi</span>
<span class="k">done</span>

<span class="c1"># Generate client config</span>
cat &gt; <span class="si">${</span><span class="nv">CONFIGS_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">1</span><span class="si">}</span>.ovpn <span class="s">&lt;&lt;EOF
</span><span class="s">$(cat ${BASE_CONF})
</span><span class="s">&lt;key&gt;
</span><span class="s">$(cat ${CLIENT_KEY})
</span><span class="s">&lt;/key&gt;
</span><span class="s">&lt;cert&gt;
</span><span class="s">$(cat ${CLIENT_CERT})
</span><span class="s">&lt;/cert&gt;
</span><span class="s">&lt;ca&gt;
</span><span class="s">$(cat ${CA_FILE})
</span><span class="s">&lt;/ca&gt;
</span><span class="s">&lt;tls-auth&gt;
</span><span class="s">$(cat ${TA_FILE})
</span><span class="s">&lt;/tls-auth&gt;
</span><span class="s">EOF</span>
</code></pre><p><span class="code-copy button main small" data-clipboard-text="#!/bin/bash FILES_DIR=$HOME/openvpn-clients/files BASE_DIR=$HOME/openvpn-clients/base CONFIGS_DIR=$HOME/openvpn-clients/configs BASE_CONF=${BASE_DIR}/client.conf CA_FILE=${BASE_DIR}/ca.crt TA_FILE=${BASE_DIR}/ta.key CLIENT_CERT=${FILES_DIR}/${1}.crt CLIENT_KEY=${FILES_DIR}/${1}.key # Test for files for i in &quot;$BASE_CONF&quot; &quot;$CA_FILE&quot; &quot;$TA_FILE&quot; &quot;$CLIENT_CERT&quot; &quot;$CLIENT_KEY&quot;; do if [[ ! -f $i ]]; then echo &quot; The file $i does not exist&quot; exit 1 fi if [[ ! -r $i ]]; then echo &quot; The file $i is not readable.&quot; exit 1 fi done # Generate client config cat &gt; ${CONFIGS_DIR}/${1}.ovpn &lt;&lt;EOF $(cat ${BASE_CONF}) &lt;key&gt; $(cat ${CLIENT_KEY}) &lt;/key&gt; &lt;cert&gt; $(cat ${CLIENT_CERT}) &lt;/cert&gt; &lt;ca&gt; $(cat ${CA_FILE}) &lt;/ca&gt; &lt;tls-auth&gt; $(cat ${TA_FILE}) &lt;/tls-auth&gt; EOF ">Copy</span></p></div><p>Save the file and make it executable with <a href="https://linuxize.com/post/chmod-command-in-linux/"><code>chmod</code></a>:</p><pre class="terminal"><code>chmod u+x ~/openvpn-clients/gen_config.sh</code></pre><h2 id="creating-client-certificate-private-key-and-configuration">Creating Client Certificate Private Key and Configuration</h2><p>The process of generating a client private key and certificate request is the same as we did when generating a server key and certificate request.</p><p>As we already mentioned in the previous section, we'll generate the client private key and certificate request on the OpenVPN server. In this example, the name of the first VPN client will be <code>client1</code>.</p><ol><li>Navigate to the EasyRSA directory on your <strong>OpenVPN server</strong> and generate a new private key and a certificate request file for the client:<pre class="terminal"><code>cd ~/EasyRSA-v3.0.6/</code><code>./easyrsa gen-req client1 nopass</code></pre><p>The command will create two files, a private key (<code>client1.key</code>) and a certificate request file (<code>client1.req</code>).</p><pre><code class="language-output" data-lang="output">Common Name (eg: your user, host, or server name) [client1]:

Keypair and certificate request completed. Your files are:
req: /home/serveruser/EasyRSA-v3.0.6/pki/reqs/client1.req
key: /home/serveruser/EasyRSA-v3.0.6/pki/private/client1.key</code></pre></li><li>Copy the private key <code>client1.key</code> to the <code>~/openvpn-clients/files</code> directory you created in the previous section:<pre class="terminal"><code>cp ~/EasyRSA-v3.0.6/pki/private/client1.key ~/openvpn-clients/files/</code></pre></li><li>Transfer the certificate request file to your CA machine:<pre class="terminal"><code>scp ~/EasyRSA-v3.0.6/pki/reqs/client1.req causer@your_ca_ip:/tmp</code></pre><p>In this example we are using <a href="https://linuxize.com/post/how-to-use-scp-command-to-securely-transfer-files/"><code>scp</code></a> to transfer the file, you can also use <a href="https://linuxize.com/post/how-to-use-rsync-for-local-and-remote-data-transfer-and-synchronization/"><code>rsync</code></a> over ssh or any other secure method.</p></li><li>Login to your <strong>CA machine</strong>, switch to the EasyRSA directory and import the certificate request file:<pre class="terminal secondary-terminal"><code>cd ~/EasyRSA-v3.0.6</code><code>./easyrsa import-req /tmp/client1.req client1</code></pre><p>The first argument is the path to the certificate request file and the second one is the client name.</p><pre><code class="language-output" data-lang="output">The request has been successfully imported with a short name of: client1
You may now use this name to perform signing operations on this request.</code></pre></li><li>From within the EasyRSA directory on <strong>CA machine</strong> run the following command to sign the request:<pre class="terminal secondary-terminal"><code>cd ~/EasyRSA-v3.0.6</code><code>./easyrsa sign-req client client1</code></pre><p>You’ll be prompted to verify that the request comes from a trusted source. Type <code>yes</code> and press <code>enter</code> to confirm:</p><p>If your CA key is password protected, you’ll be prompted to enter the password. Once verified the script will generate the SSL certificate and print the full path to it.</p><pre><code class="language-output" data-lang="output">...
Certificate created at: /home/causer/EasyRSA-v3.0.6/pki/issued/client1.crt</code></pre></li><li>Next, transfer the signed certificate <code>client1.crt</code> file back to your OpenVPN server. You can use <a href="https://linuxize.com/post/how-to-use-scp-command-to-securely-transfer-files/"><code>scp</code></a>, <a href="https://linuxize.com/post/how-to-use-rsync-for-local-and-remote-data-transfer-and-synchronization/"><code>rsync</code></a> or any other secure method:<pre class="terminal secondary-terminal"><code>scp ~/EasyRSA-v3.0.6/pki/issued/client1.crt serveruser@your_server_ip:/tmp</code></pre></li><li>Login to your <strong>OpenVPN server</strong>, and move the <code>client1.crt</code> file into the <code>~/openvpn-clients/files</code> directory:<pre class="terminal"><code>mv /tmp/client1.crt ~/openvpn-clients/files</code></pre></li><li>The final step is to generate a client configuration using the <code>gen_config.sh</code> script. Switch to the <code>~/openvpn-clients</code> directory and run the script using the client name as an argument:<pre class="terminal"><code>cd ~/openvpn-clients</code><code>./gen_config.sh client1</code></pre><p>The script will create a file named <code>client1.ovpn</code> in the <code>~/client-configs/configs</code> directory. You can check by listing the directory:</p><pre class="terminal"><code>ls ~/openvpn-clients/configs</code></pre><pre><code>client1.ovpn</code></pre></li></ol><p>At this point the client configuration is created. You can now transfer the configuration file to the device you intend to use as a client.</p><p>For example to transfer the configuration file to your local machine with <code>scp</code> you should run the following command:</p><pre class="terminal"><code>scp ~/client-configs/files/client1.ovpn your_local_ip:/</code></pre><p>To add additional clients, just repeat the same steps.</p><h2 id="connecting-clients">Connecting Clients</h2><h3 id="linux">Linux</h3><p>Your distribution or desktop environment may provide a tool or graphic user interface to connect to OpenVPN servers. In this tutorial, we will show you how to connect to the server using the <code>openvpn</code> tool.</p><ul><li>Install OpenVPN on Ubuntu and Debian<pre class="terminal"><code>sudo apt update</code><code>sudo apt install openvpn</code></pre></li><li>Install OpenVPN on CentOS and Fedora<pre class="terminal"><code>sudo yum install epel-release</code><code>sudo yum install openvpn</code></pre></li></ul><p>Once the package is installed, to connect to the VPN server use the <code>openvpn</code> command and specify the client configuration file:</p><pre class="terminal"><code>sudo openvpn --config client1.ovpn</code></pre><h3 id="macos">macOS</h3><p><a href="https://tunnelblick.net/">Tunnelblick</a> is a free, open-source graphic user interface for OpenVPN on OS X and macOS.</p><h3 id="windows">Windows</h3><p>Download and install the latest build of OpenVPN application the <a href="https://openvpn.net/community-downloads/">OpenVPN's Downloads page</a>.</p><p>Copy the <code>.ovpn</code> file to the OpenVPN config folder (<code>\Users\&lt;Name&gt;\OpenVPN\Config</code> or <code>\Program Files\OpenVPN\config</code>).</p><p>Launch the OpenVPN application.</p><p>Right click on the OpenVPN system tray icon and the name of OpenVPN configuration file you copied will be listed on the menu. Click Connect.</p><h3 id="android--ios">Android &amp; iOS</h3><p>A VPN application developed by OpenVPN is available for both Android and iOS. Install the application and import the client <code>.ovp</code> file.</p><ul><li><a href="https://play.google.com/store/apps/details?id=net.openvpn.openvpn">Android OpenVPN Connect</a></li><li><a href="https://itunes.apple.com/us/app/openvpn-connect/id590379981">iOS OpenVPN Connect</a></li></ul><h2 id="revoking-client-certificates">Revoking Client Certificates</h2><p>Revoking a certificate means to invalidate a signed certificate so that it can no longer be used for accessing the OpenVPN server.</p><p>To revoke a client certificate follow the steps below:</p><ol><li>Login to your <strong>CA machine</strong> and switch to the EasyRSA directory:<pre class="terminal secondary-terminal"><code>cd EasyRSA-v3.0.6</code></pre></li><li>Run the easyrsa script using the <code>revoke</code> argument, followed by the client name you want to revoke:<pre class="terminal secondary-terminal"><code>./easyrsa revoke client1</code></pre><p>You’ll be prompted to verify that you wish to revoke the certificate. Type <code>yes</code> and press <code>enter</code> to confirm:</p><pre><code class="language-output" data-lang="output">Please confirm you wish to revoke the certificate with the following subject:

subject=
    commonName                = client1

Type the word 'yes' to continue, or any other input to abort.
Continue with revocation: yes
...</code></pre><p>If your CA key is password protected, you’ll be prompted to enter the password. Once verified the script will revoke the certificate.</p><pre><code class="language-output" data-lang="output">...
Revocation was successful. You must run gen-crl and upload a CRL to your
infrastructure in order to prevent the revoked cert from being accepted.</code></pre></li><li>Use the <code>gen-crl</code> option to generate a certificate revocation list (CRL):<pre class="terminal secondary-terminal"><code>./easyrsa gen-crl</code></pre><pre><code class="language-output" data-lang="output">An updated CRL has been created.
CRL file: /home/causer/EasyRSA-v3.0.6/pki/crl.pem</code></pre></li><li>Upload the CRL file to the OpenVPN server:<pre class="terminal secondary-terminal"><code>scp ~/EasyRSA-v3.0.6/pki/crl.pem serveruser@your_server_ip:/tmp</code></pre></li><li>Login to your <strong>OpenVPN server</strong> server and move the file to the <code>/etc/openvpn</code> directory:<pre class="terminal"><code>sudo mv /tmp/crl.pem /etc/openvpn</code></pre></li><li>Open the OpenVPN server configuration file:<pre class="terminal"><code>sudo nano /etc/openvpn/server1.conf</code></pre><p>Paste the following line at the end of the file</p><div class="code-label">/etc/openvpn/server1.conf</div><div class="highlight"><pre class="chroma"><code><span class="na">crl-verify crl.pem</span></code></pre><p><span class="code-copy button main small" data-clipboard-text="crl-verify crl.pem">Copy</span></p></div><p>Save and close the file.</p></li><li>Restart the OpenVPN service for the revocation directive to take effect:<pre class="terminal"><code>sudo systemctl restart openvpn@server1</code></pre><p>At this point, the client should no longer be able to access the OpenVPN server using the revoked certificate.</p></li></ol><p>If you need revoke additional client certificates just repeat the same steps.</p><h2 id="conclusion">Conclusion</h2><p>In this tutorial, you learned how to install and configure an OpenVPN server on an Debian 9 machine.</p></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on 12 May 2020</div><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ffachinformatiker.github.io%2Ffachinformatiker.github.io%2Fhow-to-set-up-an-openvpn-server-on-debian-9.html" class="js-share facebook" title="Share with Facebook" rel="nofollow noopener noreferrer" aria-label="Share with Facebook"><svg class="u-icon"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Ffachinformatiker.github.io%2Ffachinformatiker.github.io%2Fhow-to-set-up-an-openvpn-server-on-debian-9.html&amp;via=psvisualdesign&amp;text=How%20To%20Set%20Up%20an%20OpenVPN%20Server%20on%20Debian%209" class="js-share twitter" title="Share with Twitter" rel="nofollow noopener noreferrer" aria-label="Share with Twitter"><svg class="u-icon"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://wa.me/?text=How%20To%20Set%20Up%20an%20OpenVPN%20Server%20on%20Debian%209 https%3A%2F%2Ffachinformatiker.github.io%2Ffachinformatiker.github.io%2Fhow-to-set-up-an-openvpn-server-on-debian-9.html" class="js-share whatsapp" rel="nofollow noopener noreferrer" title="Share with WhatsApp" aria-label="Share with WhatsApp"><svg class="u-icon"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#whatsapp"/></svg></a></div></aside><footer class="post__footer"><div class="post__bio box"><div><h4 class="h6"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" title="Patrick Szalewicz">Patrick Szalewicz</a></h4></div></div><nav class="post__nav box"><div class="post__nav__prev"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-install-nodejs-and-npm.html" class="post__nav__link" rel="prev"><div class="u-small">Previous Post<h5>How to Install Node.js and npm</h5></div></a></div></nav><div class="post__related box"><h3 class="box__title">Related posts</h3><div class="post__related-wrap"><figure class="post__related-item"><figcaption><h4 class="post__related-title"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/debian-10-set-up-openvpn-server-in-5-minutes.html" class="inverse">Debian 10 Set Up OpenVPN Server In 5 Minutes</a></h4><time datetime="2019-12-23T12:24" class="u-small">23 December 2019</time></figcaption></figure><figure class="post__related-item"><figcaption><h4 class="post__related-title"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-can-i-have-my-own-public-dns-server-like-1111.html" class="inverse">How can I have my own Public DNS Server (like 1.1.1.1)?</a></h4><time datetime="2019-07-11T20:59" class="u-small">11 July 2019</time></figcaption></figure><figure class="post__related-item"><figcaption><h4 class="post__related-title"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/setting-up-a-caching-only-dns-server.html" class="inverse">Setting up a Caching-Only DNS Server</a></h4><time datetime="2019-07-11T20:57" class="u-small">11 July 2019</time></figcaption></figure></div></div></footer></article></main><div class="sidebar"><section class="box"><h3 class="box__title">Follow us</h3><div class="follow"><a href="twitter.com/psvisualdesign" class="twitter" aria-label="Twitter"><svg class="u-icon"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#twitter"/></svg> Twitter </a><a href="instagram.com/psvisualdesign" class="instagram" aria-label="Instagram"><svg class="u-icon"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#instagram"/></svg> Instagram </a><a href="youtube.com/psvisualdesign" class="youtube" aria-label="Youtube"><svg class="u-icon"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#youtube"/></svg> Youtube</a></div></section><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/github/">GitHub</a> <span class="u-small">(3)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/homelab/">Homelab</a> <span class="u-small">(25)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/infos/">Infos</a> <span class="u-small">(6)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/java/">Java</a> <span class="u-small">(2)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/linux/">Linux</a> <span class="u-small">(43)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/lost-place/">Lost Place</a> <span class="u-small">(2)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/networking/">Networking</a> <span class="u-small">(10)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/photography/">Photography</a> <span class="u-small">(5)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/private/">Private</a> <span class="u-small">(4)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/projects/">Projects</a> <span class="u-small">(11)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/random/">Random</a> <span class="u-small">(1)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/raspberry-pi/">Raspberry Pi</a> <span class="u-small">(37)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/repost/">Repost</a> <span class="u-small">(2)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/review/">Review</a> <span class="u-small">(2)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/security/">Security</a> <span class="u-small">(10)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/server/">Server</a> <span class="u-small">(26)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/tutorials/">Tutorials</a> <span class="u-small">(45)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/unboxing/">Unboxing</a> <span class="u-small">(2)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/usefull/">Usefull</a> <span class="u-small">(8)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/videography/">Videography</a> <span class="u-small">(2)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://fachinformatiker.github.io/fachinformatiker.github.io/">fachinformatiker.app</a><nav><ul class="footer__nav"></ul></nav><div class="footer__copyright">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii Static CMS</a></div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/scripts.min.js?v=225cfb4a7e546edee710c4f1208e81e2"></script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>This website uses cookies</h2><p>Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="#not-specified">More details...</a></p><form><input id="gdpr-necessary" name="gdpr-necessary" checked="checked" disabled="disabled" type="checkbox"> <label for="gdpr-necessary">Required</label> <input id="gdpr-functions" name="gdpr-functions" type="checkbox"> <label for="gdpr-functions">Functionality</label> <input id="gdpr-analytics" name="gdpr-analytics" type="checkbox"> <label for="gdpr-analytics">Analytical</label> <input id="gdpr-marketing" name="gdpr-marketing" type="checkbox"> <label for="gdpr-marketing">Marketing</label><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Save</button></p></form><span class="cookie-popup-label">Cookie Policy</span></div><script>(function() {
                function addScript (src, inline) {
                    var newScript = document.createElement('script');

                    if (src) {
                        newScript.setAttribute('src', src);
                    }

                    if (inline) {
                        newScript.text = inline;
                    }

                    document.body.appendChild(newScript);
                }

                var popup = document.querySelector('.js-cookie-popup');
                var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                var save = popup.querySelector('button');
                var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                

                popup.addEventListener('click', function() {
                    if (!popup.classList.contains('cookie-popup--is-sticky')) {
                        popup.classList.add('cookie-popup--is-sticky');
                    }
                });

                save.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    popup.classList.remove('cookie-popup--is-sticky');
                    var allowedGroups = [];

                    for (var i = 0; i < checkboxes.length; i++) {
                        if (checkboxes[i].checked) {
                            var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }

                            allowedGroups.push(groupName);
                        }
                    }

                    localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                    popup.classList.remove('cookie-popup--is-sticky');

                    setTimeout(function () {
                        if (currentConfig !== null) {
                            window.location.reload();
                        }
                    }, 250);
                });

                if (currentConfig === null) {
                    popup.classList.add('cookie-popup--is-sticky');
                } else {
                    if (currentConfig !== '') {
                        var allowedGroups = currentConfig.split(',');

                        for (var i = 0; i < allowedGroups.length; i++) {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                            var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');

                            if (checkbox) {
                                checkbox.checked = true;
                            }

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                }
            })();</script></body></html>