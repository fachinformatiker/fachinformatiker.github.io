<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>A Guide to Java Sockets - fachinformatiker.app</title><meta name="description" content="Neues zum Thema Technik, Medien, etc.
Gerne bringe ich dir auch in meinen Tutorials, schriftlich wie auch audiovisuell, neues bei und erweitere dein Wissen."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://fachinformatiker.github.io/fachinformatiker.github.io/a-guide-to-java-sockets.html"><link rel="amphtml" href="https://fachinformatiker.github.io/fachinformatiker.github.io/amp/a-guide-to-java-sockets.html"><link rel="alternate" type="application/atom+xml" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.json"><meta property="og:title" content="A Guide to Java Sockets"><meta property="og:site_name" content="fachinformatiker.app"><meta property="og:description" content="Neues zum Thema Technik, Medien, etc.
Gerne bringe ich dir auch in meinen Tutorials, schriftlich wie auch audiovisuell, neues bei und erweitere dein Wissen."><meta property="og:url" content="https://fachinformatiker.github.io/fachinformatiker.github.io/a-guide-to-java-sockets.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@psvisualdesign"><meta name="twitter:title" content="A Guide to Java Sockets"><meta name="twitter:description" content="Neues zum Thema Technik, Medien, etc.
Gerne bringe ich dir auch in meinen Tutorials, schriftlich wie auch audiovisuell, neues bei und erweitere dein Wissen."><style>:root {
                --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
                --heading-font: var(--body-font);
                --post-entry-font: var(--body-font);
                --logo-font: var(--body-font);
                --menu-font: var(--body-font)
            }</style><link rel="stylesheet" href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/css/style.css?v=873a5ca0069471e5b0a81f6a9be47718"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://fachinformatiker.github.io/fachinformatiker.github.io/a-guide-to-java-sockets.html"},"headline":"A Guide to Java Sockets","datePublished":"2020-01-29T10:00","dateModified":"2020-05-12T08:44","description":"<h2 data-id=\"Overview\"><strong>1. Overview</strong></h2>\n<div id=\"Overview\" class=\"bd-anchor\"></div>\n<p>The term <em>socket </em><i>programming</i> refers to writing programs that execute across multiple computers in which the devices are all connected to each other using a network.</p>\n<p>There are two communication protocols that one can use for socket programming: <strong>User Datagram Protocol (UDP) and Transfer Control Protocol (TCP)</strong>.</p>\n<div class=\"code-block code-block-2\"></div>\n<p>The main difference between the two is that UDP is connectionless, meaning there is no session between the client and the server while TCP is connection-oriented, meaning an exclusive connection must first be established between client and server for communication to take place.</p>\n<p>This tutorial presents <strong>an introduction to sockets programming over TCP/IP</strong> networks and demonstrates how to write client/server applications in Java. UDP is not a mainstream protocol and as such may not be often encountered.</p>\n","author":{"@type":"Person","name":"Patrick Szalewicz"},"publisher":{"@type":"Organization","name":"Patrick Szalewicz"}}</script><script src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/ls.object-fit.min.js?v=cdedd9262bb7b299d0ebe1deaea5b924"></script><script async src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/lazysizes.min.js?v=d8513e7860f747ccf55c52308943beab"></script></head><body><header class="topbar" id="js-header"><div class="topbar__inner"><a class="logo" href="https://fachinformatiker.github.io/fachinformatiker.github.io/">fachinformatiker.app</a></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2020-05-12T08:55">May 12, 2020</time></div><div class="infobar__search"><form action="https://fachinformatiker.github.io/fachinformatiker.github.io/search.html"><input type="search" name="q" placeholder=" search..."> <button type="submit" aria-label="Search"><svg width="15px" height="14px"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#search"/></svg></button></form></div></div><main class="main"><article class="post"><header class="u-header post__header"><h1>A Guide to Java Sockets</h1><div class="u-header__meta u-small"><div><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" title="Patrick Szalewicz">Patrick Szalewicz</a> <time datetime="2020-01-29T10:00">January 29, 2020 </time><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/java/" class="u-tag u-tag--1">Java</a></div></div></header><div class="post__entry u-inner"><h2 data-id="Overview"><strong>1. Overview</strong></h2><div id="Overview" class="bd-anchor"></div><p>The term <em>socket </em><i>programming</i> refers to writing programs that execute across multiple computers in which the devices are all connected to each other using a network.</p><p>There are two communication protocols that one can use for socket programming: <strong>User Datagram Protocol (UDP) and Transfer Control Protocol (TCP)</strong>.</p><div class="code-block code-block-2"></div><p>The main difference between the two is that UDP is connectionless, meaning there is no session between the client and the server while TCP is connection-oriented, meaning an exclusive connection must first be established between client and server for communication to take place.</p><p>This tutorial presents <strong>an introduction to sockets programming over TCP/IP</strong> networks and demonstrates how to write client/server applications in Java. UDP is not a mainstream protocol and as such may not be often encountered.</p><h2 data-id="Setup"><strong>2. Project Setup</strong></h2><div id="Setup" class="bd-anchor"></div><p>Java provides a collection of classes and interfaces that take care of low-level communication details between the client and the server.</p><p>These are mostly contained in the <em>java.net</em> package, so we need to make the following import:</p><div><div id="highlighter_526638" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>import</code> <code>java.net.*;</code></div></div></td></tr></tbody></table></div></div><p>We also need the <em>java.io</em> package which gives us input and output streams to write to and read from while communicating:</p><div><div id="highlighter_975125" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>import</code> <code>java.io.*;</code></div></div></td></tr></tbody></table></div></div><p>For the sake of simplicity, we'll run our client and server programs on the same computer. If we were to execute them on different networked computers, the only thing that would change is the IP address, in this case, we will use <em>localhost</em> on <em>127.0.0.1</em>.</p><h2 data-id="Example"><strong>3. Simple Example</strong></h2><div id="Example" class="bd-anchor"></div><p>Let's get our hands dirty with the most <strong>basic of examples involving a client and a server</strong>. It's going to be a two-way communication application where the client greets the server and the server responds.</p><p>Let's create the server application in a class called <em>GreetServer.java</em> with the following code.</p><p>We include the <em>main</em> method and the global variables to draw attention to how we'll be running all servers in this article. In the rest of the examples in the articles, we'll omit this kind of more repetitive code:</p><div><div id="highlighter_471601" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>public</code> <code>class</code> <code>GreetServer {</code></div><div class="line number2 index1 alt1"><code>    </code><code>private</code> <code>ServerSocket serverSocket;</code></div><div class="line number3 index2 alt2"><code>    </code><code>private</code> <code>Socket clientSocket;</code></div><div class="line number4 index3 alt1"><code>    </code><code>private</code> <code>PrintWriter out;</code></div><div class="line number5 index4 alt2"><code>    </code><code>private</code> <code>BufferedReader in;</code></div><div class="line number6 index5 alt1"></div><div class="line number7 index6 alt2"><code>    </code><code>public</code> <code>void</code> <code>start(</code><code>int</code> <code>port) {</code></div><div class="line number8 index7 alt1"><code>        </code><code>serverSocket =</code><code>new</code> <code>ServerSocket(port);</code></div><div class="line number9 index8 alt2"><code>        </code><code>clientSocket = serverSocket.accept();</code></div><div class="line number10 index9 alt1"><code>        </code><code>out =</code><code>new</code> <code>PrintWriter(clientSocket.getOutputStream(),</code><code>true</code><code>);</code></div><div class="line number11 index10 alt2"><code>        </code><code>in =</code><code>new</code> <code>BufferedReader(</code><code>new</code> <code>InputStreamReader(clientSocket.getInputStream()));</code></div><div class="line number12 index11 alt1"><code>        </code><code>String greeting = in.readLine();</code></div><div class="line number13 index12 alt2"><code>            </code><code>if</code> <code>(</code><code>"hello server"</code><code>.equals(greeting)) {</code></div><div class="line number14 index13 alt1"><code>                </code><code>out.println(</code><code>"hello client"</code><code>);</code></div><div class="line number15 index14 alt2"><code>            </code><code>}</code></div><div class="line number16 index15 alt1"><code>            </code><code>else</code> <code>{</code></div><div class="line number17 index16 alt2"><code>                </code><code>out.println(</code><code>"unrecognised greeting"</code><code>);</code></div><div class="line number18 index17 alt1"><code>            </code><code>}</code></div><div class="line number19 index18 alt2"><code>    </code><code>}</code></div><div class="line number20 index19 alt1"></div><div class="line number21 index20 alt2"><code>    </code><code>public</code> <code>void</code> <code>stop() {</code></div><div class="line number22 index21 alt1"><code>        </code><code>in.close();</code></div><div class="line number23 index22 alt2"><code>        </code><code>out.close();</code></div><div class="line number24 index23 alt1"><code>        </code><code>clientSocket.close();</code></div><div class="line number25 index24 alt2"><code>        </code><code>serverSocket.close();</code></div><div class="line number26 index25 alt1"><code>    </code><code>}</code></div><div class="line number27 index26 alt2"><code>    </code><code>public</code> <code>static</code> <code>void</code> <code>main(String[] args) {</code></div><div class="line number28 index27 alt1"><code>        </code><code>GreetServer server=</code><code>new</code> <code>GreetServer();</code></div><div class="line number29 index28 alt2"><code>        </code><code>server.start(</code><code>6666</code><code>);</code></div><div class="line number30 index29 alt1"><code>    </code><code>}</code></div><div class="line number31 index30 alt2"><code>}</code></div></div></td></tr></tbody></table></div></div><p>Let's also create a client called <em>GreetClient.java</em> with this code:</p><div class="code-block code-block-3"></div><div><div id="highlighter_58220" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>public</code> <code>class</code> <code>GreetClient {</code></div><div class="line number2 index1 alt1"><code>    </code><code>private</code> <code>Socket clientSocket;</code></div><div class="line number3 index2 alt2"><code>    </code><code>private</code> <code>PrintWriter out;</code></div><div class="line number4 index3 alt1"><code>    </code><code>private</code> <code>BufferedReader in;</code></div><div class="line number5 index4 alt2"></div><div class="line number6 index5 alt1"><code>    </code><code>public</code> <code>void</code> <code>startConnection(String ip,</code><code>int</code> <code>port) {</code></div><div class="line number7 index6 alt2"><code>        </code><code>clientSocket =</code><code>new</code> <code>Socket(ip, port);</code></div><div class="line number8 index7 alt1"><code>        </code><code>out =</code><code>new</code> <code>PrintWriter(clientSocket.getOutputStream(),</code><code>true</code><code>);</code></div><div class="line number9 index8 alt2"><code>        </code><code>in =</code><code>new</code> <code>BufferedReader(</code><code>new</code> <code>InputStreamReader(clientSocket.getInputStream()));</code></div><div class="line number10 index9 alt1"><code>    </code><code>}</code></div><div class="line number11 index10 alt2"></div><div class="line number12 index11 alt1"><code>    </code><code>public</code> <code>String sendMessage(String msg) {</code></div><div class="line number13 index12 alt2"><code>        </code><code>out.println(msg);</code></div><div class="line number14 index13 alt1"><code>        </code><code>String resp = in.readLine();</code></div><div class="line number15 index14 alt2"><code>        </code><code>return</code> <code>resp;</code></div><div class="line number16 index15 alt1"><code>    </code><code>}</code></div><div class="line number17 index16 alt2"></div><div class="line number18 index17 alt1"><code>    </code><code>public</code> <code>void</code> <code>stopConnection() {</code></div><div class="line number19 index18 alt2"><code>        </code><code>in.close();</code></div><div class="line number20 index19 alt1"><code>        </code><code>out.close();</code></div><div class="line number21 index20 alt2"><code>        </code><code>clientSocket.close();</code></div><div class="line number22 index21 alt1"><code>    </code><code>}</code></div><div class="line number23 index22 alt2"><code>}</code></div></div></td></tr></tbody></table></div></div><p><strong>Let's start the server;</strong> in your IDE you do this by simply running it as a Java application.</p><p>And now let's send a greeting to the server using a unit test, which confirms that the server actually sends a greeting in response:</p><div><div id="highlighter_378270" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>@Test</code></div><div class="line number2 index1 alt1"><code>public</code> <code>void</code> <code>givenGreetingClient_whenServerRespondsWhenStarted_thenCorrect() {</code></div><div class="line number3 index2 alt2"><code>    </code><code>GreetClient client =</code><code>new</code> <code>GreetClient();</code></div><div class="line number4 index3 alt1"><code>    </code><code>client.startConnection(</code><code>"127.0.0.1"</code><code>,</code><code>6666</code><code>);</code></div><div class="line number5 index4 alt2"><code>    </code><code>String response = client.sendMessage(</code><code>"hello server"</code><code>);</code></div><div class="line number6 index5 alt1"><code>    </code><code>assertEquals(</code><code>"hello client"</code><code>, response);</code></div><div class="line number7 index6 alt2"><code>}</code></div></div></td></tr></tbody></table></div></div><p>Don't worry if you don't entirely understand what is happening here, as this example is meant to give us a feel of what to expect later on in the article.</p><p>In the following sections, we will dissect <strong>socket communication</strong> using this simple example and dive deeper into the details with more examples.</p><h2 data-id="Work"><strong>4. How Sockets Work</strong></h2><div id="Work" class="bd-anchor"></div><p>We will use the above example to step through different parts of this section.</p><p>By definition, a <em>socket</em> is one endpoint of a two-way communication link between two programs running on different computers on a network. A socket is bound to a port number so that the transport layer can identify the application that data is destined to be sent to.</p><h3 data-id="1-the-server"><strong>4.1. The Server</strong></h3><div id="1-the-server" class="bd-anchor"></div><p>Usually, a server runs on a specific computer on the network and has a socket that is bound to a specific port number. In our case, we use the same computer as the client and started the server on port <em>6666</em>:</p><div><div id="highlighter_497821" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>ServerSocket serverSocket =</code><code>new</code> <code>ServerSocket(</code><code>6666</code><code>);</code></div></div></td></tr></tbody></table></div></div><p>The server just waits, listening to the socket for a client to make a connection request. This happens in the next step:</p><div><div id="highlighter_469893" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>Socket clientSocket = serverSocket.accept();</code></div></div></td></tr></tbody></table></div></div><p>When the server code encounters the <em>accept</em> method, it blocks until a client makes a connection request to it.</p><p>If everything goes well, the server <em>accepts</em> the connection. Upon acceptance, the server gets a new socket, <em>clientSocket</em>, bound to the same local port, <em>6666</em>, and also has its remote endpoint set to the address and port of the client.</p><p>At this point, the new <em>Socket</em> object puts the server in direct connection with the client, we can then access the output and input streams to write and receive messages to and from the client respectively:</p><div class="code-block code-block-4"></div><div><div id="highlighter_865828" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>PrintWriter out =</code><code>new</code> <code>PrintWriter(clientSocket.getOutputStream(),</code><code>true</code><code>);</code></div><div class="line number2 index1 alt1"><code>BufferedReader in =</code><code>new</code> <code>BufferedReader(</code><code>new</code> <code>InputStreamReader(clientSocket.getInputStream()));</code></div></div></td></tr></tbody></table></div></div><p>From here onwards, the server is capable of exchanging messages with the client endlessly until the socket is closed with its streams.</p><p>However, in our example the server can only send a greeting response before it closes the connection, this means that if we ran our test again, the connection would be refused.</p><p>To allow continuity in communication, we will have to read from the input stream inside a <em>while</em> loop and only exit when the client sends a termination request, we will see this in action in the following section.</p><p>For every new client, the server needs a new socket returned by the <em>accept</em> call. The <em>serverSocket </em>is used to continue to listen for connection requests while tending to the needs of the connected clients. We have not allowed for this yet in our first example.</p><h3 data-id="2-the-client"><strong>4.2. The Client</strong></h3><div id="2-the-client" class="bd-anchor"></div><p>The client must know the hostname or IP of the machine on which the server is running and the port number on which the server is listening.</p><p>To make a connection request, the client tries to rendezvous with the server on the server's machine and port:</p><div><div id="highlighter_932479" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>Socket clientSocket =</code><code>new</code> <code>Socket(</code><code>"127.0.0.1"</code><code>,</code><code>6666</code><code>);</code></div></div></td></tr></tbody></table></div></div><p>The client also needs to identify itself to the server so it binds to a local port number, assigned by the system, that it will use during this connection. We don't deal with this ourselves.</p><p>The above constructor only creates a new socket when the server has <em>accepted</em> the connection, otherwise, we will get a connection refused exception. When successfully created we can then obtain input and output streams from it to communicate with the server:</p><div><div id="highlighter_657840" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>PrintWriter out =</code><code>new</code> <code>PrintWriter(clientSocket.getOutputStream(),</code><code>true</code><code>);</code></div><div class="line number2 index1 alt1"><code>BufferedReader in =</code><code>new</code> <code>BufferedReader(</code><code>new</code> <code>InputStreamReader(clientSocket.getInputStream()));</code></div></div></td></tr></tbody></table></div></div><p>The input stream of the client is connected to the output stream of the server, just like the input stream of the server is connected to the output stream of the client.</p><h2 data-id="Communication"><strong>5. Continuous Communication</strong></h2><div id="Communication" class="bd-anchor"></div><p>Our current server blocks until a client connects to it and then blocks again to listen to a message from the client, after the single message, it closes the connection because we have not dealt with continuity.</p><p>So it is only helpful in ping requests, but imagine we would like to implement a chat server, continuous back and forth communication between server and client would definitely be required.</p><div class="code-block code-block-5"></div><p>We will have to create a while loop to continuously observe the input stream of the server for incoming messages.</p><p>Let's create a new server called <em>EchoServer.java</em> whose sole purpose is to echo back whatever messages it receives from clients:</p><div><div id="highlighter_603158" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>public</code> <code>class</code> <code>EchoServer {</code></div><div class="line number2 index1 alt1"><code>    </code><code>public</code> <code>void</code> <code>start(</code><code>int</code> <code>port) {</code></div><div class="line number3 index2 alt2"><code>        </code><code>serverSocket =</code><code>new</code> <code>ServerSocket(port);</code></div><div class="line number4 index3 alt1"><code>        </code><code>clientSocket = serverSocket.accept();</code></div><div class="line number5 index4 alt2"><code>        </code><code>out =</code><code>new</code> <code>PrintWriter(clientSocket.getOutputStream(),</code><code>true</code><code>);</code></div><div class="line number6 index5 alt1"><code>        </code><code>in =</code><code>new</code> <code>BufferedReader(</code><code>new</code> <code>InputStreamReader(clientSocket.getInputStream()));</code></div><div class="line number7 index6 alt2"><code>        </code></div><div class="line number8 index7 alt1"><code>        </code><code>String inputLine;</code></div><div class="line number9 index8 alt2"><code>        </code><code>while</code> <code>((inputLine = in.readLine()) !=</code><code>null</code><code>) {</code></div><div class="line number10 index9 alt1"><code>        </code><code>if</code> <code>(</code><code>"."</code><code>.equals(inputLine)) {</code></div><div class="line number11 index10 alt2"><code>            </code><code>out.println(</code><code>"good bye"</code><code>);</code></div><div class="line number12 index11 alt1"><code>            </code><code>break</code><code>;</code></div><div class="line number13 index12 alt2"><code>         </code><code>}</code></div><div class="line number14 index13 alt1"><code>         </code><code>out.println(inputLine);</code></div><div class="line number15 index14 alt2"><code>    </code><code>}</code></div><div class="line number16 index15 alt1"><code>}</code></div></div></td></tr></tbody></table></div></div><p>Notice that we have added a termination condition where the while loop exits when we receive a period character.</p><p>We will start <em>EchoServer</em> using the main method just as we did for the <em>GreetServer</em>. This time, we start it on another port such as <em>4444</em> to avoid confusion.</p><p>The <em>EchoClient</em> is similar to <em>GreetClient</em>, so we can duplicate the code. We are separating them for clarity.</p><p>In a different test class, we shall create a test to show that multiple requests to the <em>EchoServer</em> will be served without the server closing the socket. This is true as long as we are sending requests from the same client.</p><p>Dealing with multiple clients is a different case, which we shall see in a subsequent section.</p><p>Let's create a <em>setup</em> method to initiate a connection with the server:</p><div><div id="highlighter_348141" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>@Before</code></div><div class="line number2 index1 alt1"><code>public</code> <code>void</code> <code>setup() {</code></div><div class="line number3 index2 alt2"><code>    </code><code>client =</code><code>new</code> <code>EchoClient();</code></div><div class="line number4 index3 alt1"><code>    </code><code>client.startConnection(</code><code>"127.0.0.1"</code><code>,</code><code>4444</code><code>);</code></div><div class="line number5 index4 alt2"><code>}</code></div></div></td></tr></tbody></table></div></div><p>We will equally create a <em>tearDown</em> method to release all our resources, this is best practice for every case where we use network resources:</p><div><div id="highlighter_97601" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>@After</code></div><div class="line number2 index1 alt1"><code>public</code> <code>void</code> <code>tearDown() {</code></div><div class="line number3 index2 alt2"><code>    </code><code>client.stopConnection();</code></div><div class="line number4 index3 alt1"><code>}</code></div></div></td></tr></tbody></table></div></div><p>Let's then test our echo server with a few requests:</p><div><div id="highlighter_447157" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>@Test</code></div><div class="line number2 index1 alt1"><code>public</code> <code>void</code> <code>givenClient_whenServerEchosMessage_thenCorrect() {</code></div><div class="line number3 index2 alt2"><code>    </code><code>String resp1 = client.sendMessage(</code><code>"hello"</code><code>);</code></div><div class="line number4 index3 alt1"><code>    </code><code>String resp2 = client.sendMessage(</code><code>"world"</code><code>);</code></div><div class="line number5 index4 alt2"><code>    </code><code>String resp3 = client.sendMessage(</code><code>"!"</code><code>);</code></div><div class="line number6 index5 alt1"><code>    </code><code>String resp4 = client.sendMessage(</code><code>"."</code><code>);</code></div><div class="line number7 index6 alt2"><code>    </code></div><div class="line number8 index7 alt1"><code>    </code><code>assertEquals(</code><code>"hello"</code><code>, resp1);</code></div><div class="line number9 index8 alt2"><code>    </code><code>assertEquals(</code><code>"world"</code><code>, resp2);</code></div><div class="line number10 index9 alt1"><code>    </code><code>assertEquals(</code><code>"!"</code><code>, resp3);</code></div><div class="line number11 index10 alt2"><code>    </code><code>assertEquals(</code><code>"good bye"</code><code>, resp4);</code></div><div class="line number12 index11 alt1"><code>}</code></div></div></td></tr></tbody></table></div></div><p>This is an improvement over the initial example, where we would only communicate once before the server closed our connection; <strong>now we send a termination signal to tell the server when we're done with the session</strong>.</p><div class="code-block code-block-6"></div><h2 data-id="Multiple"><strong>6. Server with Multiple Clients</strong></h2><div id="Multiple" class="bd-anchor"></div><p>Much as the previous example was an improvement over the first one, it is still not that great a solution. A server must have the capacity to service many clients and many requests simultaneously.</p><p><strong>Handling multiple clients is what we are going to cover in this section.</strong></p><p>Another feature we will see here is that the same client could disconnect and reconnect again, without getting a connection refused exception or a connection reset on the server. Previously we were not able to do this.</p><p>This means that our server is going to be more robust and resilient across multiple requests from multiple clients.</p><p>How we will do this is to create a new socket for every new client and service that client's requests on a different thread. The number of clients being served simultaneously will equal the number of threads running.</p><p>The main thread will be running a while loop as it listens for new connections.</p><p>Enough talk, let's create another server called <em>EchoMultiServer.java.</em> Inside it, we will create a handler thread class to manage each client's communications on its socket:</p><div><div id="highlighter_135518" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>public</code> <code>class</code> <code>EchoMultiServer {</code></div><div class="line number2 index1 alt1"><code>    </code><code>private</code> <code>ServerSocket serverSocket;</code></div><div class="line number3 index2 alt2"></div><div class="line number4 index3 alt1"><code>    </code><code>public</code> <code>void</code> <code>start(</code><code>int</code> <code>port) {</code></div><div class="line number5 index4 alt2"><code>        </code><code>serverSocket =</code><code>new</code> <code>ServerSocket(port);</code></div><div class="line number6 index5 alt1"><code>        </code><code>while</code> <code>(</code><code>true</code><code>)</code></div><div class="line number7 index6 alt2"><code>            </code><code>new</code> <code>EchoClientHandler(serverSocket.accept()).start();</code></div><div class="line number8 index7 alt1"><code>    </code><code>}</code></div><div class="line number9 index8 alt2"></div><div class="line number10 index9 alt1"><code>    </code><code>public</code> <code>void</code> <code>stop() {</code></div><div class="line number11 index10 alt2"><code>        </code><code>serverSocket.close();</code></div><div class="line number12 index11 alt1"><code>    </code><code>}</code></div><div class="line number13 index12 alt2"></div><div class="line number14 index13 alt1"><code>    </code><code>private</code> <code>static</code> <code>class</code> <code>EchoClientHandler</code><code>extends</code> <code>Thread {</code></div><div class="line number15 index14 alt2"><code>        </code><code>private</code> <code>Socket clientSocket;</code></div><div class="line number16 index15 alt1"><code>        </code><code>private</code> <code>PrintWriter out;</code></div><div class="line number17 index16 alt2"><code>        </code><code>private</code> <code>BufferedReader in;</code></div><div class="line number18 index17 alt1"></div><div class="line number19 index18 alt2"><code>        </code><code>public</code> <code>EchoClientHandler(Socket socket) {</code></div><div class="line number20 index19 alt1"><code>            </code><code>this</code><code>.clientSocket = socket;</code></div><div class="line number21 index20 alt2"><code>        </code><code>}</code></div><div class="line number22 index21 alt1"></div><div class="line number23 index22 alt2"><code>        </code><code>public</code> <code>void</code> <code>run() {</code></div><div class="line number24 index23 alt1"><code>            </code><code>out =</code><code>new</code> <code>PrintWriter(clientSocket.getOutputStream(),</code><code>true</code><code>);</code></div><div class="line number25 index24 alt2"><code>            </code><code>in =</code><code>new</code> <code>BufferedReader(</code></div><div class="line number26 index25 alt1"><code>              </code><code>new</code> <code>InputStreamReader(clientSocket.getInputStream()));</code></div><div class="line number27 index26 alt2"><code>            </code></div><div class="line number28 index27 alt1"><code>            </code><code>String inputLine;</code></div><div class="line number29 index28 alt2"><code>            </code><code>while</code> <code>((inputLine = in.readLine()) !=</code><code>null</code><code>) {</code></div><div class="line number30 index29 alt1"><code>                </code><code>if</code> <code>(</code><code>"."</code><code>.equals(inputLine)) {</code></div><div class="line number31 index30 alt2"><code>                    </code><code>out.println(</code><code>"bye"</code><code>);</code></div><div class="line number32 index31 alt1"><code>                    </code><code>break</code><code>;</code></div><div class="line number33 index32 alt2"><code>                </code><code>}</code></div><div class="line number34 index33 alt1"><code>                </code><code>out.println(inputLine);</code></div><div class="line number35 index34 alt2"><code>            </code><code>}</code></div><div class="line number36 index35 alt1"></div><div class="line number37 index36 alt2"><code>            </code><code>in.close();</code></div><div class="line number38 index37 alt1"><code>            </code><code>out.close();</code></div><div class="line number39 index38 alt2"><code>            </code><code>clientSocket.close();</code></div><div class="line number40 index39 alt1"><code>    </code><code>}</code></div><div class="line number41 index40 alt2"><code>}</code></div></div></td></tr></tbody></table></div></div><p>Notice that we now call <em>accept</em> inside a <em>while</em> loop. Every time the <em>while</em> loop is executed, it blocks on the <em>accept</em> call until a new client connects, then the handler thread, <em>EchoClientHandler</em>, is created for this client.</p><p>What happens inside the thread is what we previously did in the <em>EchoServer</em> where we handled only a single client. So the <em>EchoMultiServer</em> delegates this work to <em>EchoClientHandler</em> so that it can keep listening for more clients in the <em>while</em> loop.</p><p>We will still use <em>EchoClient</em> to test the server, this time we will create multiple clients each sending and receiving multiple messages from the server.</p><p>Let's start our server using its main method on port <em>5555</em>.</p><div class="code-block code-block-7"></div><p>For clarity, we will still put tests in a new suite:</p><div><div id="highlighter_453104" class="syntaxhighlighter notranslate java"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code>@Test</code></div><div class="line number2 index1 alt1"><code>public</code> <code>void</code> <code>givenClient1_whenServerResponds_thenCorrect() {</code></div><div class="line number3 index2 alt2"><code>    </code><code>EchoClient client1 =</code><code>new</code> <code>EchoClient();</code></div><div class="line number4 index3 alt1"><code>    </code><code>client1.startConnection(</code><code>"127.0.0.1"</code><code>,</code><code>5555</code><code>);</code></div><div class="line number5 index4 alt2"><code>    </code><code>String msg1 = client1.sendMessage(</code><code>"hello"</code><code>);</code></div><div class="line number6 index5 alt1"><code>    </code><code>String msg2 = client1.sendMessage(</code><code>"world"</code><code>);</code></div><div class="line number7 index6 alt2"><code>    </code><code>String terminate = client1.sendMessage(</code><code>"."</code><code>);</code></div><div class="line number8 index7 alt1"><code>    </code></div><div class="line number9 index8 alt2"><code>    </code><code>assertEquals(msg1,</code><code>"hello"</code><code>);</code></div><div class="line number10 index9 alt1"><code>    </code><code>assertEquals(msg2,</code><code>"world"</code><code>);</code></div><div class="line number11 index10 alt2"><code>    </code><code>assertEquals(terminate,</code><code>"bye"</code><code>);</code></div><div class="line number12 index11 alt1"><code>}</code></div><div class="line number13 index12 alt2"></div><div class="line number14 index13 alt1"><code>@Test</code></div><div class="line number15 index14 alt2"><code>public</code> <code>void</code> <code>givenClient2_whenServerResponds_thenCorrect() {</code></div><div class="line number16 index15 alt1"><code>    </code><code>EchoClient client2 =</code><code>new</code> <code>EchoClient();</code></div><div class="line number17 index16 alt2"><code>    </code><code>client2.startConnection(</code><code>"127.0.0.1"</code><code>,</code><code>5555</code><code>);</code></div><div class="line number18 index17 alt1"><code>    </code><code>String msg1 = client2.sendMessage(</code><code>"hello"</code><code>);</code></div><div class="line number19 index18 alt2"><code>    </code><code>String msg2 = client2.sendMessage(</code><code>"world"</code><code>);</code></div><div class="line number20 index19 alt1"><code>    </code><code>String terminate = client2.sendMessage(</code><code>"."</code><code>);</code></div><div class="line number21 index20 alt2"><code>    </code></div><div class="line number22 index21 alt1"><code>    </code><code>assertEquals(msg1,</code><code>"hello"</code><code>);</code></div><div class="line number23 index22 alt2"><code>    </code><code>assertEquals(msg2,</code><code>"world"</code><code>);</code></div><div class="line number24 index23 alt1"><code>    </code><code>assertEquals(terminate,</code><code>"bye"</code><code>);</code></div><div class="line number25 index24 alt2"><code>}</code></div></div></td></tr></tbody></table></div></div><p>We could create as many of these test cases as we please, each spawning a new client and the server will serve all of them.</p><h2 data-id="Conclusion"><strong>7. Conclusion</strong></h2><div id="Conclusion" class="bd-anchor"></div><p>In this tutorial, we've focused on <strong>an introduction to sockets programming over TCP/IP</strong> and wrote a simple Client/Server application in Java.</p></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on May 12, 2020</div><div class="post__share"></div></aside><footer class="post__footer"><div class="post__bio box"><div><h4 class="h6"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" title="Patrick Szalewicz">Patrick Szalewicz</a></h4></div></div><nav class="post__nav box"><div class="post__nav__prev"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-add-and-delete-users.html" class="post__nav__link" rel="prev"><div class="u-small">Previous Post<h5>How to Add and Delete Users</h5></div></a></div><div class="post__nav__next"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-change-user-password.html" class="post__nav__link" rel="next"><div class="u-small">Next Post<h5>How to Change User Password</h5></div></a></div></nav><div class="post__related box"><h3 class="box__title">Related posts</h3><div class="post__related-wrap"><figure class="post__related-item"><figcaption><h4 class="post__related-title"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/java-kurs-kostenlos.html" class="inverse">Java Kurs kostenlos!</a></h4><time datetime="2019-03-11T18:40" class="u-small">March 11, 2019</time></figcaption></figure></div></div></footer></article></main><div class="sidebar"><section class="box authors"><h3 class="box__title">Authors</h3><ul class="authors__cotainer"><li class="authors__item"><div><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" class="authors__title">Patrick Szalewicz</a> <span class="u-small">Post: 70</span></div></li></ul></section><section class="newsletter box box--gray"><h3 class="box__title">Newsletter</h3><p class="newsletter__description">Sign up to receive email updates and to hear what's going on with us!</p><form>...</form></section><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/github/">GitHub</a> <span class="u-small">(3)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/homelab/">Homelab</a> <span class="u-small">(25)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/infos/">Infos</a> <span class="u-small">(6)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/java/">Java</a> <span class="u-small">(2)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/linux/">Linux</a> <span class="u-small">(43)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://fachinformatiker.github.io/fachinformatiker.github.io/">fachinformatiker.app</a><nav><ul class="footer__nav"></ul></nav><div class="footer__copyright">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii Static CMS</a></div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/scripts.min.js?v=225cfb4a7e546edee710c4f1208e81e2"></script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>This website uses cookies</h2><p>Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="#not-specified">More details...</a></p><form><input id="gdpr-necessary" name="gdpr-necessary" checked="checked" disabled="disabled" type="checkbox"> <label for="gdpr-necessary">Required</label> <input id="gdpr-functions" name="gdpr-functions" type="checkbox"> <label for="gdpr-functions">Functionality</label> <input id="gdpr-analytics" name="gdpr-analytics" type="checkbox"> <label for="gdpr-analytics">Analytical</label> <input id="gdpr-marketing" name="gdpr-marketing" type="checkbox"> <label for="gdpr-marketing">Marketing</label><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Save</button></p></form><span class="cookie-popup-label">Cookie Policy</span></div><script>(function() {
                function addScript (src, inline) {
                    var newScript = document.createElement('script');

                    if (src) {
                        newScript.setAttribute('src', src);
                    }

                    if (inline) {
                        newScript.text = inline;
                    }

                    document.body.appendChild(newScript);
                }

                var popup = document.querySelector('.js-cookie-popup');
                var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                var save = popup.querySelector('button');
                var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                

                popup.addEventListener('click', function() {
                    if (!popup.classList.contains('cookie-popup--is-sticky')) {
                        popup.classList.add('cookie-popup--is-sticky');
                    }
                });

                save.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    popup.classList.remove('cookie-popup--is-sticky');
                    var allowedGroups = [];

                    for (var i = 0; i < checkboxes.length; i++) {
                        if (checkboxes[i].checked) {
                            var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }

                            allowedGroups.push(groupName);
                        }
                    }

                    localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                    popup.classList.remove('cookie-popup--is-sticky');

                    setTimeout(function () {
                        if (currentConfig !== null) {
                            window.location.reload();
                        }
                    }, 250);
                });

                if (currentConfig === null) {
                    popup.classList.add('cookie-popup--is-sticky');
                } else {
                    if (currentConfig !== '') {
                        var allowedGroups = currentConfig.split(',');

                        for (var i = 0; i < allowedGroups.length; i++) {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                            var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');

                            if (checkbox) {
                                checkbox.checked = true;
                            }

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                }
            })();</script></body></html>