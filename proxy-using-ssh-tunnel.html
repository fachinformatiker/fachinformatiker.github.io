<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Proxy Using SSH Tunnel - fachinformatiker.app</title><meta name="description" content="We can set up a socks proxy on top of a SSH tunnel. Besides the common proxy functions, such as web browsing, the proxy on top of SSH tunnel also ensures the security between the browser and the proxy server (the SSH server). In this post, we introduce and explain how to set up a proxy over SSH tunnel and the mechanism of it.A simple exampleLet’s start with a simple example. We can access a sshd server sshd_server and we want to use it as a socks5 proxy server. It is simple by using ssh:$ ssh -D 8080 username@sshd_serverAfter that, set the browser such as firefox’s proxy option to use socks5 proxy 127.0.0.1:8080. That’s it!Then, check whether your IP is from the proxy from the websites’ view: Who am I."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://fachinformatiker.github.io/fachinformatiker.github.io/proxy-using-ssh-tunnel.html"><link rel="alternate" type="application/atom+xml" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.json"><meta property="og:title" content="Proxy Using SSH Tunnel"><meta property="og:site_name" content="fachinformatiker.app"><meta property="og:description" content="We can set up a socks proxy on top of a SSH tunnel. Besides the common proxy functions, such as web browsing, the proxy on top of SSH tunnel also ensures the security between the browser and the proxy server (the SSH server). In this post, we introduce and explain how to set up a proxy over SSH tunnel and the mechanism of it.A simple exampleLet’s start with a simple example. We can access a sshd server sshd_server and we want to use it as a socks5 proxy server. It is simple by using ssh:$ ssh -D 8080 username@sshd_serverAfter that, set the browser such as firefox’s proxy option to use socks5 proxy 127.0.0.1:8080. That’s it!Then, check whether your IP is from the proxy from the websites’ view: Who am I."><meta property="og:url" content="https://fachinformatiker.github.io/fachinformatiker.github.io/proxy-using-ssh-tunnel.html"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><style>h1,h2,h3,h4,h5,h6,.btn,[type=button],[type=submit],button,.navbar .navbar__menu li,.navbar_mobile_sidebar .navbar__menu li,.feed__author,.post__tag,.post__share>a span,.post__nav-link>span,.footer{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}body,h1,.h1,blockquote,.search__input,.author__name,.author__info>p,.feed__item h2,.post__nav-link{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/css/style.css?v=cc87cb8806c844f0646558fe70d5c5d1"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://fachinformatiker.github.io/fachinformatiker.github.io/proxy-using-ssh-tunnel.html"},"headline":"Proxy Using SSH Tunnel","datePublished":"2019-07-11T21:02","dateModified":"2020-05-12T08:43","description":"<p>We can set up a socks proxy on top of a <a href=\"https://www.systutorials.com/goto/ssh\">SSH</a> tunnel. Besides the common proxy functions, such as web browsing, the proxy on top of SSH tunnel also ensures the security between the browser and the proxy server (the SSH server). In this post, we introduce and explain how to set up a proxy over SSH tunnel and the mechanism of it.</p>\n<h3><span id=\"a-simple-example\">A simple example</span></h3>\n<p>Let’s start with a simple example. We can access a sshd server <em>sshd_server</em> and we want to use it as a socks5 proxy server. It is simple by using ssh:</p>\n<pre class=\"hljs ruby\">$ ssh -D <span class=\"hljs-number\">8080</span> username@sshd_server</pre>\n<p>After that, set the browser such as firefox’s proxy option to use socks5 proxy 127.0.0.1:8080. That’s it!</p>\n<p>Then, check whether your IP is from the proxy from the websites’ view: <a href=\"http://www.pkill.info/whoami/\">Who am I</a>.</p>\n","author":{"@type":"Person","name":"Patrick Szalewicz"},"publisher":{"@type":"Organization","name":"Patrick Szalewicz"}}</script><script src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/ls.parent-fit.min.js?v=f8467455ea5c88e3e51a4f212d2632bd"></script><script async src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/lazysizes.min.js?v=6a69d476c93de2b78a72acb259abccea"></script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://fachinformatiker.github.io/fachinformatiker.github.io/">fachinformatiker.app</a><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><form action="https://fachinformatiker.github.io/fachinformatiker.github.io/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="search..." autofocus="autofocus"></form><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2019-07-11T21:02">July 11, 2019</time></div><h1>Proxy Using SSH Tunnel</h1><div class="post__meta post__meta--author"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" class="feed__author invert">Patrick Szalewicz</a></div></div></header></div><div class="wrapper post__entry"><p>We can set up a socks proxy on top of a <a href="https://www.systutorials.com/goto/ssh">SSH</a> tunnel. Besides the common proxy functions, such as web browsing, the proxy on top of SSH tunnel also ensures the security between the browser and the proxy server (the SSH server). In this post, we introduce and explain how to set up a proxy over SSH tunnel and the mechanism of it.</p><h3><span id="a-simple-example">A simple example</span></h3><p>Let’s start with a simple example. We can access a sshd server <em>sshd_server</em> and we want to use it as a socks5 proxy server. It is simple by using ssh:</p><pre class="hljs ruby">$ ssh -D <span class="hljs-number">8080</span> username@sshd_server</pre><p>After that, set the browser such as firefox’s proxy option to use socks5 proxy 127.0.0.1:8080. That’s it!</p><p>Then, check whether your IP is from the proxy from the websites’ view: <a href="http://www.pkill.info/whoami/">Who am I</a>.</p><h3><span id="making-ssh-proxy">Making ssh proxy</span></h3><p>We can set up a more complex proxy server through ssh. For example, we have a sshd server s2 and another server s1 as the proxy server. Then we can set up a proxy server system using ssh tunnel. s1 will act as the proxy server, while s2 connects to the service provider (s3). The overall system can be shown as this:</p><pre class="hljs xml">c0:p0 <span class="hljs-tag">&lt;<span class="hljs-name">--</span>&gt;</span> s1:p1 <span class="hljs-tag">&lt;<span class="hljs-name">==</span>&gt;</span> s2:p2 <span class="hljs-tag">&lt;<span class="hljs-name">--</span>&gt;</span> s3</pre><p>Maybe most of the time c0 and s1 are the same machines as the simple example at the beginning of the post.</p><p>Using ssh as a proxy to browse the web is very useful under some situation: Local access restriction such as behind a strict firewall in some country, company or school; You are in a insecure <a href="https://www.systutorials.com/category/tutorial/network/">network</a> environment while you want to login to your account.</p><p>Now let’s look at how to set up proxy by using ssh tunnel. This uses ssh’s “dynamic” port forwarding function by using parameter “-D”. ssh allocates a socket to listen to port on the local side, optionally bound to the specified ip address. Whenever a connection is made to this port, the connection is forwarded over the ssh channel, and the application protocol is then used to determine where to connect to from the remote machine.</p><h4><span id="1-proxy-listening-to-localhost-port-only">1) Proxy listening to localhost port only</span></h4><p>This proxy server can only be used on localhost, which means the other users can not use it. c0 and s1 in the graph above are the same machine.<br>The command is:</p><pre class="hljs ruby">$ ssh -D p1 username@sshd_server</pre><p>p1 is the port on localhost. Any port larger than 1024 can be chosen as p1. After setting up this proxy tunnel, set the proxy option in browser to <em>127.0.0.1:p1 </em>and using socks5. Then it is done. Enjoy it now :) .</p><h4><span id="2-proxy-listening-to-specific-ip">2) Proxy listening to specific IP</span></h4><p>This kind of proxy server can provide service to other users. Users (and include yourself of course) can use this socks5 proxy with address <em>s1_ip</em> and port <em>p1</em>.<br>The command is:</p><pre class="hljs ruby">$ ssh -D <span class="hljs-symbol">s1_ip:</span>p1 username@sshd_server</pre><p>This command sets up a socks5 proxy server on s1. The proxy address is: <em>s1_ip:p1</em>.</p><ul><li>Some useful ssh arguments</li></ul><p>There are some other ssh arguments that can make the port forwarding more convenient for us:</p><pre class="hljs sql">-C  Requests gzip compression of all data
-T  Disable pseudo-tty allocation
-N  <span class="hljs-keyword">Do</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">execute</span> a remote command. This <span class="hljs-keyword">is</span> useful <span class="hljs-keyword">for</span> just forwarding ports.
-f  Requests ssh <span class="hljs-keyword">to</span> <span class="hljs-keyword">go</span> <span class="hljs-keyword">to</span> background just <span class="hljs-keyword">before</span> command execution.
-n  Redirects stdin <span class="hljs-keyword">from</span> /dev/<span class="hljs-literal">null</span> (actually, prevents reading <span class="hljs-keyword">from</span> stdin).
-q  Quiet mode. Causes most <span class="hljs-keyword">warning</span> <span class="hljs-keyword">and</span> diagnostic messages <span class="hljs-keyword">to</span> be suppressed.</pre><p>These arguments can be used with -D for different usages. I like to use this combination:</p><pre class="hljs ruby">$ ssh -CnfND <span class="hljs-number">8080</span> username@sshd_server</pre><p>When I want to close the ssh proxy tunnel, I need to find the <em>pid</em> of it by</p><pre class="hljs perl">$ ps aux | <span class="hljs-keyword">grep</span> ssh</pre><p>and then kill it.</p><p>Or let it run in the shell:</p><pre class="hljs ruby">$ ssh -CTND <span class="hljs-number">8080</span> username@sshd_server</pre><p>You can also configure it to listen on all addresses on the host by:</p><pre class="code not-hl hljs ruby">$ ssh -D <span class="hljs-string">"*:8080"</span> username@sshd_server</pre><h3 class="prettyprint"><span id="port-forwarding-squid-proxy">Port forwarding squid proxy</span></h3><p>This post mainly focus on using ssh to build up the proxy system. But the connection between the client and the other kind of proxy server such as squid can also make use of ssh tunnel. I only provides a simple example here, while more details of ssh port forwarding can be found from <a href="https://www.systutorials.com/b/818/port-forwarding-using-ssh-tunnel/">Port Forwarding using ssh Tunnel</a>. For example, the proxy server and port is <em>proxy:port</em>. Now we can port forwards port 8080 on localhost to it by this:</p><pre class="hljs ruby">$ ssh -L <span class="hljs-number">8080</span><span class="hljs-symbol">:proxy</span><span class="hljs-symbol">:port</span> username@sshd_server</pre></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on May 12, 2020</p><ul class="post__tag"><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/homelab/">Homelab</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/linux/">Linux</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/networking/">Networking</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/raspberry-pi/">Raspberry Pi</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/server/">Server</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/tutorials/">Tutorials</a></li></ul><div class="post__share"></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" class="invert" rel="author">Patrick Szalewicz</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-can-i-have-my-own-public-dns-server-like-1111.html" class="invert post__nav-link" rel="prev"><span>Previous</span> How can I have my own Public DNS Server (like 1.1.1.1)?</a></div><div class="post__nav-next"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/hackathon-bremen.html" class="invert post__nav-link" rel="next"><span>Next</span> Hackathon Bremen </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2019-12-25T00:14" class="feed__date">December 25, 2019</time></div><h3 class="h1"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/ssh-tunnelling-for-fun-and-profit-autossh.html" class="invert">SSH tunnelling for fun and profit: Autossh</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2019-12-27T12:25" class="feed__date">December 27, 2019</time></div><h3 class="h1"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-enable-ssh-access-using-a-gpg-key-for-authentication.html" class="invert">How to enable SSH access using a GPG key for authentication</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2019-12-15T20:57" class="feed__date">December 15, 2019</time></div><h3 class="h1"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/reverse-ssh-tunnel-mit-autossh.html" class="invert">Reverse ssh tunnel mit autossh</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii Static CMS</a></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/scripts.min.js?v=205f40927e4a45297a0b266e50ad78d5"></script><script>var lazyFeaturedImage=function lazyFeaturedImage(){var b=document.querySelectorAll(".hero__image-img");for(var a=0;a<b.length;a++){var c=b[a];c.addEventListener("lazyloaded",function(f){var d=f.target.parentNode;d.classList.add("hero__image--overlay")})}};lazyFeaturedImage();</script></body></html>