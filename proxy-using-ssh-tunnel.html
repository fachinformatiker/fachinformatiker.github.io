<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Proxy Using SSH Tunnel - fachinformatiker.app</title><meta name="description" content="Neues zum Thema Technik, Medien, etc.
Gerne bringe ich dir auch in meinen Tutorials, schriftlich wie auch audiovisuell, neues bei und erweitere dein Wissen."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://fachinformatiker.github.io/fachinformatiker.github.io/proxy-using-ssh-tunnel.html"><link rel="amphtml" href="https://fachinformatiker.github.io/fachinformatiker.github.io/amp/proxy-using-ssh-tunnel.html"><link rel="alternate" type="application/atom+xml" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.json"><meta property="og:title" content="Proxy Using SSH Tunnel"><meta property="og:site_name" content="fachinformatiker.app"><meta property="og:description" content="Neues zum Thema Technik, Medien, etc.
Gerne bringe ich dir auch in meinen Tutorials, schriftlich wie auch audiovisuell, neues bei und erweitere dein Wissen."><meta property="og:url" content="https://fachinformatiker.github.io/fachinformatiker.github.io/proxy-using-ssh-tunnel.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@psvisualdesign"><meta name="twitter:title" content="Proxy Using SSH Tunnel"><meta name="twitter:description" content="Neues zum Thema Technik, Medien, etc.
Gerne bringe ich dir auch in meinen Tutorials, schriftlich wie auch audiovisuell, neues bei und erweitere dein Wissen."><style>:root {
                --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
                --heading-font: var(--body-font);
                --post-entry-font: var(--body-font);
                --logo-font: var(--body-font);
                --menu-font: var(--body-font)
            }</style><link rel="stylesheet" href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/css/style.css?v=873a5ca0069471e5b0a81f6a9be47718"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://fachinformatiker.github.io/fachinformatiker.github.io/proxy-using-ssh-tunnel.html"},"headline":"Proxy Using SSH Tunnel","datePublished":"2019-07-11T21:02","dateModified":"2020-05-12T08:43","description":"<p>We can set up a socks proxy on top of a <a href=\"https://www.systutorials.com/goto/ssh\">SSH</a> tunnel. Besides the common proxy functions, such as web browsing, the proxy on top of SSH tunnel also ensures the security between the browser and the proxy server (the SSH server). In this post, we introduce and explain how to set up a proxy over SSH tunnel and the mechanism of it.</p>\n<h3><span id=\"a-simple-example\">A simple example</span></h3>\n<p>Let’s start with a simple example. We can access a sshd server <em>sshd_server</em> and we want to use it as a socks5 proxy server. It is simple by using ssh:</p>\n<pre class=\"hljs ruby\">$ ssh -D <span class=\"hljs-number\">8080</span> username@sshd_server</pre>\n<p>After that, set the browser such as firefox’s proxy option to use socks5 proxy 127.0.0.1:8080. That’s it!</p>\n<p>Then, check whether your IP is from the proxy from the websites’ view: <a href=\"http://www.pkill.info/whoami/\">Who am I</a>.</p>\n","author":{"@type":"Person","name":"Patrick Szalewicz"},"publisher":{"@type":"Organization","name":"Patrick Szalewicz"}}</script><script src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/ls.object-fit.min.js?v=cdedd9262bb7b299d0ebe1deaea5b924"></script><script async src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/lazysizes.min.js?v=d8513e7860f747ccf55c52308943beab"></script></head><body><header class="topbar" id="js-header"><div class="topbar__inner"><a class="logo" href="https://fachinformatiker.github.io/fachinformatiker.github.io/">fachinformatiker.app</a></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2020-05-12T08:55">May 12, 2020</time></div><div class="infobar__search"><form action="https://fachinformatiker.github.io/fachinformatiker.github.io/search.html"><input type="search" name="q" placeholder=" search..."> <button type="submit" aria-label="Search"><svg width="15px" height="14px"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#search"/></svg></button></form></div></div><main class="main"><article class="post"><header class="u-header post__header"><h1>Proxy Using SSH Tunnel</h1><div class="u-header__meta u-small"><div><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" title="Patrick Szalewicz">Patrick Szalewicz</a> <time datetime="2019-07-11T21:02">July 11, 2019 </time><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/homelab/" class="u-tag u-tag--1">Homelab</a></div></div></header><div class="post__entry u-inner"><p>We can set up a socks proxy on top of a <a href="https://www.systutorials.com/goto/ssh">SSH</a> tunnel. Besides the common proxy functions, such as web browsing, the proxy on top of SSH tunnel also ensures the security between the browser and the proxy server (the SSH server). In this post, we introduce and explain how to set up a proxy over SSH tunnel and the mechanism of it.</p><h3><span id="a-simple-example">A simple example</span></h3><p>Let’s start with a simple example. We can access a sshd server <em>sshd_server</em> and we want to use it as a socks5 proxy server. It is simple by using ssh:</p><pre class="hljs ruby">$ ssh -D <span class="hljs-number">8080</span> username@sshd_server</pre><p>After that, set the browser such as firefox’s proxy option to use socks5 proxy 127.0.0.1:8080. That’s it!</p><p>Then, check whether your IP is from the proxy from the websites’ view: <a href="http://www.pkill.info/whoami/">Who am I</a>.</p><h3><span id="making-ssh-proxy">Making ssh proxy</span></h3><p>We can set up a more complex proxy server through ssh. For example, we have a sshd server s2 and another server s1 as the proxy server. Then we can set up a proxy server system using ssh tunnel. s1 will act as the proxy server, while s2 connects to the service provider (s3). The overall system can be shown as this:</p><pre class="hljs xml">c0:p0 <span class="hljs-tag">&lt;<span class="hljs-name">--</span>&gt;</span> s1:p1 <span class="hljs-tag">&lt;<span class="hljs-name">==</span>&gt;</span> s2:p2 <span class="hljs-tag">&lt;<span class="hljs-name">--</span>&gt;</span> s3</pre><p>Maybe most of the time c0 and s1 are the same machines as the simple example at the beginning of the post.</p><p>Using ssh as a proxy to browse the web is very useful under some situation: Local access restriction such as behind a strict firewall in some country, company or school; You are in a insecure <a href="https://www.systutorials.com/category/tutorial/network/">network</a> environment while you want to login to your account.</p><p>Now let’s look at how to set up proxy by using ssh tunnel. This uses ssh’s “dynamic” port forwarding function by using parameter “-D”. ssh allocates a socket to listen to port on the local side, optionally bound to the specified ip address. Whenever a connection is made to this port, the connection is forwarded over the ssh channel, and the application protocol is then used to determine where to connect to from the remote machine.</p><h4><span id="1-proxy-listening-to-localhost-port-only">1) Proxy listening to localhost port only</span></h4><p>This proxy server can only be used on localhost, which means the other users can not use it. c0 and s1 in the graph above are the same machine.<br>The command is:</p><pre class="hljs ruby">$ ssh -D p1 username@sshd_server</pre><p>p1 is the port on localhost. Any port larger than 1024 can be chosen as p1. After setting up this proxy tunnel, set the proxy option in browser to <em>127.0.0.1:p1 </em>and using socks5. Then it is done. Enjoy it now :) .</p><h4><span id="2-proxy-listening-to-specific-ip">2) Proxy listening to specific IP</span></h4><p>This kind of proxy server can provide service to other users. Users (and include yourself of course) can use this socks5 proxy with address <em>s1_ip</em> and port <em>p1</em>.<br>The command is:</p><pre class="hljs ruby">$ ssh -D <span class="hljs-symbol">s1_ip:</span>p1 username@sshd_server</pre><p>This command sets up a socks5 proxy server on s1. The proxy address is: <em>s1_ip:p1</em>.</p><ul><li>Some useful ssh arguments</li></ul><p>There are some other ssh arguments that can make the port forwarding more convenient for us:</p><pre class="hljs sql">-C  Requests gzip compression of all data
-T  Disable pseudo-tty allocation
-N  <span class="hljs-keyword">Do</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">execute</span> a remote command. This <span class="hljs-keyword">is</span> useful <span class="hljs-keyword">for</span> just forwarding ports.
-f  Requests ssh <span class="hljs-keyword">to</span> <span class="hljs-keyword">go</span> <span class="hljs-keyword">to</span> background just <span class="hljs-keyword">before</span> command execution.
-n  Redirects stdin <span class="hljs-keyword">from</span> /dev/<span class="hljs-literal">null</span> (actually, prevents reading <span class="hljs-keyword">from</span> stdin).
-q  Quiet mode. Causes most <span class="hljs-keyword">warning</span> <span class="hljs-keyword">and</span> diagnostic messages <span class="hljs-keyword">to</span> be suppressed.</pre><p>These arguments can be used with -D for different usages. I like to use this combination:</p><pre class="hljs ruby">$ ssh -CnfND <span class="hljs-number">8080</span> username@sshd_server</pre><p>When I want to close the ssh proxy tunnel, I need to find the <em>pid</em> of it by</p><pre class="hljs perl">$ ps aux | <span class="hljs-keyword">grep</span> ssh</pre><p>and then kill it.</p><p>Or let it run in the shell:</p><pre class="hljs ruby">$ ssh -CTND <span class="hljs-number">8080</span> username@sshd_server</pre><p>You can also configure it to listen on all addresses on the host by:</p><pre class="code not-hl hljs ruby">$ ssh -D <span class="hljs-string">"*:8080"</span> username@sshd_server</pre><h3 class="prettyprint"><span id="port-forwarding-squid-proxy">Port forwarding squid proxy</span></h3><p>This post mainly focus on using ssh to build up the proxy system. But the connection between the client and the other kind of proxy server such as squid can also make use of ssh tunnel. I only provides a simple example here, while more details of ssh port forwarding can be found from <a href="https://www.systutorials.com/b/818/port-forwarding-using-ssh-tunnel/">Port Forwarding using ssh Tunnel</a>. For example, the proxy server and port is <em>proxy:port</em>. Now we can port forwards port 8080 on localhost to it by this:</p><pre class="hljs ruby">$ ssh -L <span class="hljs-number">8080</span><span class="hljs-symbol">:proxy</span><span class="hljs-symbol">:port</span> username@sshd_server</pre></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on May 12, 2020</div><div class="post__share"></div></aside><footer class="post__footer"><div class="post__bio box"><div><h4 class="h6"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" title="Patrick Szalewicz">Patrick Szalewicz</a></h4></div></div><nav class="post__nav box"><div class="post__nav__prev"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-can-i-have-my-own-public-dns-server-like-1111.html" class="post__nav__link" rel="prev"><div class="u-small">Previous Post<h5>How can I have my own Public DNS Server (like 1.1.1.1)?</h5></div></a></div><div class="post__nav__next"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/hackathon-bremen.html" class="post__nav__link" rel="next"><div class="u-small">Next Post<h5>Hackathon Bremen</h5></div></a></div></nav><div class="post__related box"><h3 class="box__title">Related posts</h3><div class="post__related-wrap"><figure class="post__related-item"><figcaption><h4 class="post__related-title"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/ssh-tunnelling-for-fun-and-profit-autossh.html" class="inverse">SSH tunnelling for fun and profit: Autossh</a></h4><time datetime="2019-12-25T00:14" class="u-small">December 25, 2019</time></figcaption></figure><figure class="post__related-item"><figcaption><h4 class="post__related-title"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-enable-ssh-access-using-a-gpg-key-for-authentication.html" class="inverse">How to enable SSH access using a GPG key for authentication</a></h4><time datetime="2019-12-27T12:25" class="u-small">December 27, 2019</time></figcaption></figure><figure class="post__related-item"><figcaption><h4 class="post__related-title"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/reverse-ssh-tunnel-mit-autossh.html" class="inverse">Reverse ssh tunnel mit autossh</a></h4><time datetime="2019-12-15T20:57" class="u-small">December 15, 2019</time></figcaption></figure></div></div></footer></article></main><div class="sidebar"><section class="box authors"><h3 class="box__title">Authors</h3><ul class="authors__cotainer"><li class="authors__item"><div><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" class="authors__title">Patrick Szalewicz</a> <span class="u-small">Post: 70</span></div></li></ul></section><section class="newsletter box box--gray"><h3 class="box__title">Newsletter</h3><p class="newsletter__description">Sign up to receive email updates and to hear what's going on with us!</p><form>...</form></section><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/github/">GitHub</a> <span class="u-small">(3)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/homelab/">Homelab</a> <span class="u-small">(25)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/infos/">Infos</a> <span class="u-small">(6)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/java/">Java</a> <span class="u-small">(2)</span></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/linux/">Linux</a> <span class="u-small">(43)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://fachinformatiker.github.io/fachinformatiker.github.io/">fachinformatiker.app</a><nav><ul class="footer__nav"></ul></nav><div class="footer__copyright">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii Static CMS</a></div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/scripts.min.js?v=225cfb4a7e546edee710c4f1208e81e2"></script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>This website uses cookies</h2><p>Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="#not-specified">More details...</a></p><form><input id="gdpr-necessary" name="gdpr-necessary" checked="checked" disabled="disabled" type="checkbox"> <label for="gdpr-necessary">Required</label> <input id="gdpr-functions" name="gdpr-functions" type="checkbox"> <label for="gdpr-functions">Functionality</label> <input id="gdpr-analytics" name="gdpr-analytics" type="checkbox"> <label for="gdpr-analytics">Analytical</label> <input id="gdpr-marketing" name="gdpr-marketing" type="checkbox"> <label for="gdpr-marketing">Marketing</label><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Save</button></p></form><span class="cookie-popup-label">Cookie Policy</span></div><script>(function() {
                function addScript (src, inline) {
                    var newScript = document.createElement('script');

                    if (src) {
                        newScript.setAttribute('src', src);
                    }

                    if (inline) {
                        newScript.text = inline;
                    }

                    document.body.appendChild(newScript);
                }

                var popup = document.querySelector('.js-cookie-popup');
                var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                var save = popup.querySelector('button');
                var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                

                popup.addEventListener('click', function() {
                    if (!popup.classList.contains('cookie-popup--is-sticky')) {
                        popup.classList.add('cookie-popup--is-sticky');
                    }
                });

                save.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    popup.classList.remove('cookie-popup--is-sticky');
                    var allowedGroups = [];

                    for (var i = 0; i < checkboxes.length; i++) {
                        if (checkboxes[i].checked) {
                            var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }

                            allowedGroups.push(groupName);
                        }
                    }

                    localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                    popup.classList.remove('cookie-popup--is-sticky');

                    setTimeout(function () {
                        if (currentConfig !== null) {
                            window.location.reload();
                        }
                    }, 250);
                });

                if (currentConfig === null) {
                    popup.classList.add('cookie-popup--is-sticky');
                } else {
                    if (currentConfig !== '') {
                        var allowedGroups = currentConfig.split(',');

                        for (var i = 0; i < allowedGroups.length; i++) {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                            var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');

                            if (checkbox) {
                                checkbox.checked = true;
                            }

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                }
            })();</script></body></html>