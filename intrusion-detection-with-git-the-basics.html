<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Intrusion detection with git – the basics - fachinformatiker.app</title><meta name="description" content="How can you make sure all your system binaries and configuration files have not been compromised by an intruder? You can of course run rkhunter[1] or AIDE[2] on a regular base or via cron, but this is only going to show you, that a MD5 checksum has been changed.Using git as an intrusion detection system is actually more useful than you might think. You can, for example also see what configuration has been changed or overwritten by an automated repository update or you can roll back to a previous working version of a specific apache vhost. If multiple system engineers work on the same machine, you will be able to evaluate what they have done and even make sure it was actually them.Throughout this post series I will show you the power of git, sudo and gpg to create several layers of defence as well as a completely automated and comprehensible system documentation."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://fachinformatiker.github.io/fachinformatiker.github.io/intrusion-detection-with-git-the-basics.html"><link rel="alternate" type="application/atom+xml" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.json"><meta property="og:title" content="Intrusion detection with git – the basics"><meta property="og:site_name" content="fachinformatiker.app"><meta property="og:description" content="How can you make sure all your system binaries and configuration files have not been compromised by an intruder? You can of course run rkhunter[1] or AIDE[2] on a regular base or via cron, but this is only going to show you, that a MD5 checksum has been changed.Using git as an intrusion detection system is actually more useful than you might think. You can, for example also see what configuration has been changed or overwritten by an automated repository update or you can roll back to a previous working version of a specific apache vhost. If multiple system engineers work on the same machine, you will be able to evaluate what they have done and even make sure it was actually them.Throughout this post series I will show you the power of git, sudo and gpg to create several layers of defence as well as a completely automated and comprehensible system documentation."><meta property="og:url" content="https://fachinformatiker.github.io/fachinformatiker.github.io/intrusion-detection-with-git-the-basics.html"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><style>h1,h2,h3,h4,h5,h6,.btn,[type=button],[type=submit],button,.navbar .navbar__menu li,.navbar_mobile_sidebar .navbar__menu li,.feed__author,.post__tag,.post__share>a span,.post__nav-link>span,.footer{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}body,h1,.h1,blockquote,.search__input,.author__name,.author__info>p,.feed__item h2,.post__nav-link{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/css/style.css?v=cc87cb8806c844f0646558fe70d5c5d1"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://fachinformatiker.github.io/fachinformatiker.github.io/intrusion-detection-with-git-the-basics.html"},"headline":"Intrusion detection with git – the basics","datePublished":"2019-12-31T23:14","dateModified":"2020-05-12T08:44","description":"<p>How can you make sure all your system binaries and configuration files have not been compromised by an intruder? You can of course run rkhunter[1] or AIDE[2] on a regular base or via cron, but this is only going to show you, that a MD5 checksum has been changed.</p>\n<p>Using git as an intrusion detection system is actually more useful than you might think. You can, for example also see what configuration has been changed or overwritten by an automated repository update or you can roll back to a previous working version of a specific apache vhost. If multiple system engineers work on the same machine, you will be able to evaluate what they have done and even make sure it was actually them.</p>\n<p>Throughout this post series I will show you the power of git, sudo and gpg to create several layers of defence as well as a completely automated and comprehensible system documentation.</p>\n","author":{"@type":"Person","name":"Patrick Szalewicz"},"publisher":{"@type":"Organization","name":"Patrick Szalewicz"}}</script><script src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/ls.parent-fit.min.js?v=f8467455ea5c88e3e51a4f212d2632bd"></script><script async src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/lazysizes.min.js?v=6a69d476c93de2b78a72acb259abccea"></script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://fachinformatiker.github.io/fachinformatiker.github.io/">fachinformatiker.app</a><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><form action="https://fachinformatiker.github.io/fachinformatiker.github.io/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="search..." autofocus="autofocus"></form><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2019-12-31T23:14">December 31, 2019</time></div><h1>Intrusion detection with git – the basics</h1><div class="post__meta post__meta--author"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" class="feed__author invert">Patrick Szalewicz</a></div></div></header></div><div class="wrapper post__entry"><p>How can you make sure all your system binaries and configuration files have not been compromised by an intruder? You can of course run rkhunter[1] or AIDE[2] on a regular base or via cron, but this is only going to show you, that a MD5 checksum has been changed.</p><p>Using git as an intrusion detection system is actually more useful than you might think. You can, for example also see what configuration has been changed or overwritten by an automated repository update or you can roll back to a previous working version of a specific apache vhost. If multiple system engineers work on the same machine, you will be able to evaluate what they have done and even make sure it was actually them.</p><p>Throughout this post series I will show you the power of git, sudo and gpg to create several layers of defence as well as a completely automated and comprehensible system documentation.</p><h4 id="gfm-1">Cautions</h4><p>Before you are going to git your entire filesystem, you need to consider a few important aspects.</p><p>First, the repository must explicitly be restricted to the administrative user root, otherwise everyone is able to search the git index for sensitive information.</p><p>Secondly, you only want to monitor important stuff and don’t want to be bothered by vim or shell history files or even fast-growing logfiles. Data directories and other locations such as the storage of your database should also be excluded or you might see git changes in almost realtime.</p><h4 id="gfm-2">Note about compatibility</h4><p>As I have secured many CentOS machines, I will use it as a reference. Please keep in mind that some differences might apply on other versions of Linux and especially on BSD or Solaris.</p><h2 id="gfm-3">Git repository</h2><p>First things first: Create a new git repository at the very root of your file system.</p><pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /
git init
touch /.gitignore
</code></pre><p>The crucial point is to immediately restrict access to this repository and the corresponding gitignore.</p><pre><code class="bash hljs">chown root:root /.git
chown root:root /.gitignore
chmod <span class="hljs-number">700</span> /.git
chmod <span class="hljs-number">600</span> /.gitignore
</code></pre><p>Before you are going to add everything to git, you should populate your <code>.~/gitignore</code>. Here is a very basic setup which is still manageable for beginners:</p><pre><code class="bash hljs"><span class="hljs-comment">#######################################################################</span>
<span class="hljs-comment"># User defined wants</span>
<span class="hljs-comment">#######################################################################</span>

<span class="hljs-comment"># Comment this line out if you want to see sudo activity</span>
/var/db/<span class="hljs-built_in">sudo</span>/*


<span class="hljs-comment">#######################################################################</span>
<span class="hljs-comment"># Standard Excludes</span>
<span class="hljs-comment">#######################################################################</span>

<span class="hljs-comment">######## 1.0) base ########</span>
<span class="hljs-comment">#/bin</span>
/dev/
/home/
/lib
/lib64
/lost+found/
/media/
/mnt/
/opt/
/proc/
/run/
<span class="hljs-comment">#/sbin</span>
/shared/
/srv/
/sys/
/tmp/

<span class="hljs-comment">######## 2.0) /boot ########</span>
/boot/vmlinuz*
/boot/*.img
/boot/*.hmac
/boot/*.gz

<span class="hljs-comment">######## 3.0) /etc ########</span>
/etc/selinux/targeted/modules/active/modules/*.pp

<span class="hljs-comment">######## 4.0) /root ########</span>
/root/.bash_history
/root/.viminfo

<span class="hljs-comment">######## 5.0) /usr ########</span>
<span class="hljs-comment">#/usr/bin/</span>
/usr/games/
/usr/include/
/usr/lib/
/usr/lib64/
/usr/libexec/
<span class="hljs-comment">#/usr/sbin/</span>
/usr/share/
/usr/src/
/usr/tmp

<span class="hljs-comment">######## 5.1) /usr/local ########</span>
<span class="hljs-comment">#/usr/local/bin/</span>
/usr/local/games/
/usr/local/include/
/usr/local/lib/
/usr/local/lib64/
/usr/local/libexec/
<span class="hljs-comment">#/usr/local/sbin/</span>
/usr/local/share/
/usr/local/src/

<span class="hljs-comment">######## 6.0) /var ########</span>
/var/cache/
/var/log/
/var/mail/
/var/spool/
/var/tmp/
/var/www/

<span class="hljs-comment">######## 6.1) /var/lib ########</span>
/var/lib/git*
/var/lib/pear/
/var/lib/logrotate.status
/var/lib/mysql/
/var/lib/ntp/drift
/var/lib/plymouth/boot-duration
/var/lib/php/session
/var/lib/postfix/master.lock
/var/lib/rpm/
/var/lib/systemd/random-seed
/var/lib/tripwire/*
/var/lib/yum/history/
/var/lib/yum/yumdb/
/var/lib/NetworkManager/
</code></pre><p><strong>Note:</strong></p><ul><li>Remove the comment from */bin and */sbin directories, if you only want to monitor configuration changes and not add system binaries to the index.</li><li>If you want to keep track of shared libraries as well, you need to fine-tune various <strong>lib</strong> sections</li></ul><p>Further adjust the gitconfig to your needs an then add the files and do the first commit.</p><pre><code class="bash hljs">git add .
git commit -am <span class="hljs-string">'Initial commit'</span>
</code></pre><h2 id="gfm-4">Validate the repository</h2><p>As this is your first commit, you should carefully inspect all indexed files to see if something is missing or wrong:</p><pre><code class="bash hljs">git ls-tree --name-only -r HEAD
</code></pre><p>Also do a reverse check and inspect all files being ignored:</p><pre><code class="bash hljs">git ls-files -o -i --exclude-standard
</code></pre><p>If everything looks OK, you are done for now, otherwise edit your gitconfig and repeat the above steps.</p><h2 id="gfm-5">Detect anomalies</h2><p>Whenever you ssh into your machine, try to routinize the following actions to identify a possible intrusion detection:</p><ol><li>Become root</li><li>Go to the filesystem root</li><li>Check git status and git log</li></ol><p>If there is anything that looks suspicious you can always diff it against previous commits.</p><h2 id="gfm-6">Daily work: Alter your system</h2><p>Whatever you do, if it is updating or just changing a configuration, try to be strict to yourself: Do one task after the other and commit each single task (such as adding a new vhost or updating php) into the index separately.<br>If you train yourself to do this, you will end up with a very well documented system over time and also have a good overview about unwanted changes.</p><h2 id="gfm-7">Troubleshooting</h2><p>In case you add new files or folders to your gitignore and they are not being recognized after you have committed, you will probably need to rebuild the index. Simply remove all cached files and re-add them:</p><pre><code class="bash hljs">git rm -r <span class="hljs-operator">-f</span> --cached .
git add .
git commit -am <span class="hljs-string">'Meaningful commit message'</span>
</code></pre><h2 id="gfm-8">Further information</h2><p>Have a look at this github[3] repository, which will always provide the latest gitignore file. Feel free to use and/or contribute.</p><p><code>[1]</code> <a href="http://rkhunter.sourceforge.net/">http://rkhunter.sourceforge.net/</a><br><code>[2]</code> <a href="http://aide.sourceforge.net/">http://aide.sourceforge.net/</a><br><code>[3]</code> <a href="https://github.com/cytopia/git-ids">https://github.com/cytopia/git-ids</a></p><h2 id="gfm-9">Is this really enough protection?</h2><p>Of course not :-). You are still missing the power of git combined with gpg and multiple git identities via sudo. This will also eliminate the possibility that an intruder can just commit changes to your index.</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on May 12, 2020</p><ul class="post__tag"><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/linux/">Linux</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/raspberry-pi/">Raspberry Pi</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/security/">Security</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/tutorials/">Tutorials</a></li></ul><div class="post__share"></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" class="invert" rel="author">Patrick Szalewicz</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-enable-ssh-access-using-a-gpg-key-for-authentication.html" class="invert post__nav-link" rel="prev"><span>Previous</span> How to enable SSH access using a GPG key for authentication</a></div><div class="post__nav-next"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/build-your-own-dns-server-on-linux.html" class="invert post__nav-link" rel="next"><span>Next</span> Build your own DNS server on Linux </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2019-06-02T13:40" class="feed__date">June 2, 2019</time></div><h3 class="h1"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-run-a-server-at-home-without-an-ipv4-address.html" class="invert">How To Run A Server At Home Without An IPv4 Address</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii Static CMS</a></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/scripts.min.js?v=205f40927e4a45297a0b266e50ad78d5"></script><script>var lazyFeaturedImage=function lazyFeaturedImage(){var b=document.querySelectorAll(".hero__image-img");for(var a=0;a<b.length;a++){var c=b[a];c.addEventListener("lazyloaded",function(f){var d=f.target.parentNode;d.classList.add("hero__image--overlay")})}};lazyFeaturedImage();</script></body></html>