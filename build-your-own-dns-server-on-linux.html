<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Build your own DNS server on Linux - fachinformatiker.app</title><meta name="description" content="Learn how to use BIND to set up your own server for resolving domain names.In this article, I show you how to build your own name server using BIND (Berkeley Internet Name Domain). It is not as difficult as you might think, especially because you can do it in two stages.In this article, you will start by learning how to create a caching name server, then you will move on and learn how to upgrade that to a complete primary (master) domain name server for your network, complete with forward and reverse zone files."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://fachinformatiker.github.io/fachinformatiker.github.io/build-your-own-dns-server-on-linux.html"><link rel="alternate" type="application/atom+xml" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.json"><meta property="og:title" content="Build your own DNS server on Linux"><meta property="og:site_name" content="fachinformatiker.app"><meta property="og:description" content="Learn how to use BIND to set up your own server for resolving domain names.In this article, I show you how to build your own name server using BIND (Berkeley Internet Name Domain). It is not as difficult as you might think, especially because you can do it in two stages.In this article, you will start by learning how to create a caching name server, then you will move on and learn how to upgrade that to a complete primary (master) domain name server for your network, complete with forward and reverse zone files."><meta property="og:url" content="https://fachinformatiker.github.io/fachinformatiker.github.io/build-your-own-dns-server-on-linux.html"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><style>h1,h2,h3,h4,h5,h6,.btn,[type=button],[type=submit],button,.navbar .navbar__menu li,.navbar_mobile_sidebar .navbar__menu li,.feed__author,.post__tag,.post__share>a span,.post__nav-link>span,.footer{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}body,h1,.h1,blockquote,.search__input,.author__name,.author__info>p,.feed__item h2,.post__nav-link{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/css/style.css?v=cc87cb8806c844f0646558fe70d5c5d1"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://fachinformatiker.github.io/fachinformatiker.github.io/build-your-own-dns-server-on-linux.html"},"headline":"Build your own DNS server on Linux","datePublished":"2020-01-02T00:20","dateModified":"2020-05-12T08:44","description":"<div class=\"os-article__top\">\n<div class=\"os-article__top-inner\">\n<div class=\"panel-pane pane-entity-field pane-node-field-article-subhead\">\n<div class=\"field field-name-field-article-subhead field-type-text-long field-label-hidden\">\n<div class=\"field-items\">\n<h2>Learn how to use BIND to set up your own server for resolving domain names.</h2>\n</div>\n</div>\n</div>\n<div class=\"panel-pane pane-os-content-article-byline\">\n<div class=\"byline\"></div>\n</div>\n</div>\n</div>\n<div class=\"os-article__image\">\n<div class=\"panel-pane pane-entity-field pane-node-field-lead-image\">\n<div class=\"field field-name-field-lead-image field-type-image field-label-hidden\">\n<div class=\"field-items\">\n<div class=\"field-item even\"><figure class=\"image-full-size\"><img  title=\"Pixelated globe\" src=\"https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/pixelated-world.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-xs.png 300w ,https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-sm.png 480w ,https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-md.png 768w ,https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-lg.png 1024w ,https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-xl.png 1360w ,https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-2xl.png 1600w\"  alt=\"Pixelated globe\" width=\"520\" height=\"292\" /></figure></div>\n</div>\n</div>\n</div>\n<div class=\"panel-pane pane-entity-field pane-file-field-file-image-caption\">\n<div class=\"field field-name-field-file-image-caption field-type-text-long field-label-inline clearfix\"></div>\n</div>\n</div>\n<div class=\"os-article__left\">\n<div class=\"panel-pane pane-block pane-bean-email-capture widget-block widget-block__left show\">\n<div class=\"target-band-never-show-button\"></div>\n</div>\n</div>\n<div class=\"os-article__middle\">\n<div class=\"panel-pane pane-entity-field pane-node-body\">\n<div class=\"field field-name-body field-type-text-with-summary field-label-hidden\">\n<div class=\"field-items\">\n<div class=\"field-item even\">\n<p>In this article, I show you how to build your own name server using <a href=\"https://www.isc.org/downloads/bind/\" target=\"_blank\" rel=\"noopener noreferrer\">BIND</a> (Berkeley Internet Name Domain). It is not as difficult as you might think, especially because you can do it in two stages.</p>\n<p>In this article, you will start by learning how to create a caching name server, then you will move on and learn how to upgrade that to a complete primary (master) domain name server for your network, complete with forward and reverse zone files.</p>\n","author":{"@type":"Person","name":"Patrick Szalewicz"},"publisher":{"@type":"Organization","name":"Patrick Szalewicz"}}</script><script src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/ls.parent-fit.min.js?v=f8467455ea5c88e3e51a4f212d2632bd"></script><script async src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/lazysizes.min.js?v=6a69d476c93de2b78a72acb259abccea"></script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://fachinformatiker.github.io/fachinformatiker.github.io/">fachinformatiker.app</a><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><form action="https://fachinformatiker.github.io/fachinformatiker.github.io/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="search..." autofocus="autofocus"></form><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2020-01-02T00:20">January 2, 2020</time></div><h1>Build your own DNS server on Linux</h1><div class="post__meta post__meta--author"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" class="feed__author invert">Patrick Szalewicz</a></div></div></header></div><div class="wrapper post__entry"><div class="os-article__top"><div class="os-article__top-inner"><div class="panel-pane pane-entity-field pane-node-field-article-subhead"><div class="field field-name-field-article-subhead field-type-text-long field-label-hidden"><div class="field-items"><h2>Learn how to use BIND to set up your own server for resolving domain names.</h2></div></div></div><div class="panel-pane pane-os-content-article-byline"><div class="byline"></div></div></div></div><div class="os-article__image"><div class="panel-pane pane-entity-field pane-node-field-lead-image"><div class="field field-name-field-lead-image field-type-image field-label-hidden"><div class="field-items"><div class="field-item even"><figure class="image-full-size"><img class="lazyload" title="Pixelated globe" data-src="https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/pixelated-world.png" data-sizes="auto" data-srcset="https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-xs.png 300w ,https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-sm.png 480w ,https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-md.png 768w ,https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-lg.png 1024w ,https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-xl.png 1360w ,https://fachinformatiker.github.io/fachinformatiker.github.io/media/posts/119/responsive/pixelated-world-2xl.png 1600w" alt="Pixelated globe" data-aspectratio="1.780822" width="520" height="292"></figure></div></div></div></div><div class="panel-pane pane-entity-field pane-file-field-file-image-caption"><div class="field field-name-field-file-image-caption field-type-text-long field-label-inline clearfix"></div></div></div><div class="os-article__left"><div class="panel-pane pane-block pane-bean-email-capture widget-block widget-block__left show"><div class="target-band-never-show-button"></div></div></div><div class="os-article__middle"><div class="panel-pane pane-entity-field pane-node-body"><div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even"><p>In this article, I show you how to build your own name server using <a href="https://www.isc.org/downloads/bind/" target="_blank" rel="noopener noreferrer">BIND</a> (Berkeley Internet Name Domain). It is not as difficult as you might think, especially because you can do it in two stages.</p><p>In this article, you will start by learning how to create a caching name server, then you will move on and learn how to upgrade that to a complete primary (master) domain name server for your network, complete with forward and reverse zone files.</p><h2>Setting up a DNS server using BIND</h2><p>Setting up a name server using BIND is quite straightforward, so I'll show you how to do so on any computer you might have available for experimentation. This little lab project will show you how to install and configure BIND on your computer as a caching name server, test it, then set it up as a primary name server with a zone file that you can use as a name resolver for your network or just for testing.</p><p>Setting up a name server on any GNU/Linux computer you have available is technically possible because it will not interfere with other hosts on the network or their operation. However, you should probably not do this on a computer that you do not own or have the right to modify unless you have explicit permission to do so.</p><h3>My setup</h3><p>You only need one computer to perform all but one of the tasks in this lab project. I use this setup on my much more powerful ThinkPad because the name servers provided by DHCP (Dynamic Host Configuration Protocol) when I connect to non-home networks using either wired or wireless connections can sometimes be unreliable. To show that almost any host can perform well as a name server, I have tested this project on an old ASUS EeePC 900 netbook.</p><p>I will use the private IP address of my ASUS for this project but you should use the IP address of the host that you are using.</p><h3>The hosts file</h3><p>First, let's take a look at the <strong>/etc/hosts</strong> file. In its default state, there should only be two lines in the hosts file, the first two lines seen in Listing 1, below.</p><div class="geshifilter"><blockquote><div class="text geshifilter-text">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4<br>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6# Lab hosts<br>192.168.25.1        server<br>192.168.25.21      host1<br>192.168.25.22      host2<br>192.168.25.23      host3<br>192.168.25.24      host4<p></p></div></blockquote></div><p><small><i>Listing 1: You can maintain a simple hosts file to perform the function of a resolver in small networks.</i></small></p><p>Although you can add hostnames and their respective IP Addresses as shown in Listing 1, this is not an optimal solution to name services, especially when traveling. If there are other entries in your hosts file, you may need to comment them out for the duration of this project if they interfere with naming or IP addresses. Most of you will not have any entries other than the two default lines.</p><h3>Preparation</h3><p>A caching name server can't replace your use of <strong>/etc/hosts</strong> to resolve hostnames on the internal network; however, compared to using an ISP or other public name server a caching name server can improve performance when resolving commonly used external names, such as <a href="http://www.cnn.com">www.cnn.com</a>. The best part is that setting up a caching name server is quite easy.</p><p>Before starting, you should prepare by performing the following steps.</p><p>First, make backup copies of the files <strong>/etc/hosts</strong>, <strong>/etc/named.conf</strong>, <strong>resolv.conf</strong>, and <strong>/etc/sysconfig/iptables</strong>.</p><p>If they are not already installed, use your distribution's package manager to install the following BIND RPMs: <strong>bind</strong>, <strong>bind-chroot</strong>, and <strong>bind-utils</strong>. To enable your lab host to use the caching name server, you must add a name server line to point to your own host in <strong>/etc/resolv.conf</strong>. For example, if your lab host IP Address is 192.168.0.203, as is my <strong>epc</strong>, add the following line to the top of the name server list in <strong>/etc/resolv.conf</strong>:</p><pre><small><span class="geshifilter"><code>name server         192.168.0.203</code></span></small></pre><p><em>Be sure to use the IP Address of the host on which you are doing this project.</em></p><p>You could use the IP Address of your localhost, 127.0.0.1 instead of the external IP address. You should also comment out any lines pointing to other hosts as name servers. Be sure to save the revised <strong>resolv.conf</strong> file.</p><p>These changes will take effect immediately and no reboot or service restart is required. Now attempt to ping a common public host that does not block ICMP (Internet Control Message Protocol) packets; feel free to use my firewall, which is a <a href="https://opensource.com/life/16/3/firewall-your-home-network-raspberry-pi">Raspberry Pi</a>.</p><pre><small><span class="geshifilter"><code>ping wally2.both.org</code></span></small></pre><p>You should get an "unknown host" or "Name or service not known" error because you currently have no working DNS service or resolver defined in the resolv.conf file. Now use the <strong>dig</strong> command to see if name services is working.</p><pre><small><span class="geshifilter"><code>dig wally2.both.com</code></span></small></pre><p>You should get the error, "Connection timed out; no servers could be reached."</p><h3>Set up a caching name server</h3><p>A caching name server is not an authoritative source for any domain. It simply caches the results of all name resolver requests from the network that it serves to speed up responses to future requests for the same remote host.</p><p><em>Note: The <strong>named.conf</strong> file is very particular about syntax and especially punctuation. Semicolons are used to delineate the end of an entry and the end of a stanza as well as the end of a line. Be sure to add them in correctly as shown in the samples.</em></p><p>For the initial setup of the caching name server making a couple modifications to the default <strong>/etc/named.conf</strong> file is necessary, so edit that file using your favorite editor. First, add the IP address of your local test host to the "listen-on port 53" line as shown in Listing 2, below. This enables <strong>named</strong> to listen on the external IP Address of your host, so that other computers can use it as a name server as well.</p><p>By default, BIND refers to the Internet's root name servers to locate the authoritative name servers for a domain. It is possible to specify other servers that are called "Forwarders" to which the local instance of BIND will send requests instead of the root servers. This does increase the possibility of DNS hijacking.</p><p>Add a "forwarders" line as shown below. This tells your caching DNS server where to obtain IP Addresses when they are not already cached locally. The IP Addresses in the listing below is for the <a href="https://developers.google.com/speed/public-dns/" target="_blank" rel="noopener noreferrer">Google public DNS servers</a> You could use your local ISP or OpenDNS or some other public name server as your forwarder. It is not necessary to define any forwarders and, in that case, BIND would use the Internet root servers as defined in the file <strong>/var/named/named.ca</strong> to locate the authoritative name servers for domains if no forwarders are defined. But for this exercise, please define the forwarders as I have in Listing 2.</p><p>Comment out the IPV6 line because we are not using IPV6 in the lab environment. Note that the "//" two forward slashes denote comments in the <strong>named.conf</strong> file.</p><div class="geshifilter"><blockquote><div class="text geshifilter-text">//<br>// named.conf<br>// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS<br>// server as a caching only name server (as a localhost DNS resolver only).<br>// See /usr/share/doc/bind*/sample/ for example named configuration files.<br>//<br>//options {<br>listen-on port 53 { 127.0.0.1; 192.168.0.203; };<br>//      listen-on-v6 port 53 { ::1; };<br>forwarders { 8.8.8.8; 8.8.4.4; };<br>directory       "/var/named";<br>dump-file       "/var/named/data/cache_dump.db";<br>statistics-file "/var/named/data/named_stats.txt";<br>memstatistics-file "/var/named/data/named_mem_stats.txt";<br>allow-query     { localhost; 192.168.0.0/24; };<br>recursion yes;<p></p><p>dnssec-enable yes;<br>dnssec-validation yes;<br>dnssec-lookaside auto;</p><p>/* Path to ISC DLV key */<br>bindkeys-file "/etc/named.iscdlv.key";</p><p>managed-keys-directory "/var/named/dynamic";<br>};<br>logging {<br>channel default_debug {<br>file "data/named.run";<br>severity dynamic;<br>};<br>};<br>zone "." IN {<br>type hint;<br>file "named.ca";<br>};<br>include "/etc/named.rfc1912.zones";<br>include "/etc/named.root.key";</p></div></blockquote></div><p><small><i>Listing 2: The /etc/named.conf file provides the simple configuration required to set up a caching name server. The lines that need to be added or changed are highlighted in bold.</i></small></p><p>Add the local network address, 192.168.0.0/24, to the <strong>allow-query</strong> line. This line specifies the network(s) from which DNS queries will be accepted by this DNS server.</p><h4>Start the name service</h4><p>Now start the named service and configure the named service to start at every boot. I use the <strong>systemctl</strong> command on my Fedora 25 host, but the command may be different on your host, depending upon the distribution you are using. Note that the name of the BIND resolver service is named.</p><div class="geshifilter"><div class="text geshifilter-text">systemctl enable named<br>systemctl start named</div></div><p>The first test you can perform to ensure that your caching name server is working is to use <strong>dig</strong> to locate the DNS database information for wally2.both.org. To further test your caching name server, use the <strong>dig</strong> command to obtain the IP Address(es) for some common Internet websites, such as <a href="http://www.opensource.com">www.opensource.com</a>, CNN, Wired, and any others you like. The results should now show your host as the responding server.</p><p>At this point your caching name server will correctly resolve hosts on the Internet and that is because those DNS requests for public hosts are forwarded to the Google public name servers—refer to the "forwarders" line in <strong>named.conf</strong>. However, you are still dependent upon the <strong>/etc/hosts</strong> file for internal name services. Creating a primary name server can solve that problem.</p><h3>Creating a primary name server</h3><p>Once you create a caching name server, converting it into a full-fledged primary name server is not too difficult. A primary name server is the authoritative source for the domain it represents.</p><p>You need to change <strong>named.conf</strong> again and create a couple new files. You'll create a domain called Example.com, which is a domain name reserved for example purposes in documents like this one. The Example.com domain does have an IP address on the Internet and a very sparse website, but you can use the name in the rest of your lab project without causing problems for anyone. You'll use the Example.com domain as the internal domain name for the rest of this exercise.</p><p>The two new files you'll create are the forward and reverse zone files, which you'll place in the <strong>/var/named directory</strong>. This location is specified by the "directory" directive in the <strong>named.conf</strong> configuration file.</p><h4>Create the forward zone file</h4><p>The forward zone file contains "A" records that pair the names of the hosts in the zone, aka domain, with their respective IP addresses. It may also contain CNAME records, which are aliases for the real hostnames in the A records, and MX records for mail servers.</p><p>Create a basic forward zone file, <strong>/var/named/example.com.zone</strong>, and add the following lines to it. Your zone file should look like the sample zone file in Listing 3, below, when you're finished.</p><div class="geshifilter"><blockquote><div class="text geshifilter-text">; Authoritative data for example.com zone<br>;<br>$TTL 1D<br>@   IN SOA  epc.example.com   root.epc.example.com. (<br>2017031301      ; serial<br>1D              ; refresh<br>1H              ; retry<br>1W              ; expire<br>3H )            ; minimum$ORIGIN         example.com.<br>example.com.            IN      NS      epc.example.com.<br>epc                     IN      A       127.0.0.1<br>server                  IN      A       192.168.25.1<br>www                     IN      CNAME   server<br>mail                    IN      CNAME   server<br>test1                   IN      A       192.168.25.21<br>t1                      IN      CNAME   test1<br>test2                   IN      A       192.168.25.22<br>test3                   IN      A       192.168.25.23<br>test4                   IN      A       192.168.25.24<p></p><p>; Mail server MX record<br>example.com.            IN      MX      10      mail.example.com.</p></div></blockquote></div><p><small><i>Listing 3: The forward zone file for the Example.com domain contains the hostnames and their IP addresses for this domain.</i></small></p><p>The first non-comment line in Listing 3 is the Time to Live specifier, which in this case is one day for all records that are not otherwise specified. D stands for Day. The specifiers in the SOA (Start of Authority) line are just as obvious. Details of the parameters in the SOA record are described in some detail <a href="http://www.zytrax.com/books/dns/ch8/soa.html" target="_blank" rel="noopener noreferrer">here</a>.</p><p>The NS record must have the FQDN (Fully Qualified Domain Name) of the host on which you are performing this lab project. There must also be an A record in the file with a valid IP address for the host. In this case, you should use the localhost IP address of 127.0.0.1.</p><p>The entries shown above will give you a few hostnames with which to experiment.</p><p>Be sure to use today's date and append a counter starting at 01 for the serial number. The serial number above is the first change of March 4, 2017. The serial number is incremented whenever the zone file is changed. If there were secondary name servers that used this one for a primary, they would not be updated unless the serial number is incremented.</p><h4>Add the forward zone files to named.conf</h4><p>Before your DNS server will work, however, you need to create an entry in <strong>/etc/named.conf</strong> that will point to your new zone file. Add the following lines below the entry for the top-level hints zone but before the "include" lines.</p><div class="geshifilter"><blockquote><div class="text geshifilter-text">zone "example.com" IN {<br>type master;<br>file "example.com.zone";<br>};</div></blockquote></div><p><small><i>Listing 4: Add these lines to the named.conf file to add the Example.com zone file to the resolver configuration.</i></small></p><p>Now restart <strong>named</strong> to make these changes take effect. Test your name server by using the <strong>dig</strong> and <strong>nsloookup</strong> commands to obtain the IP Addresses for the hosts you have configured in the forward zone file. Note that the host does not have to exist on the network for the <strong>dig</strong> and <strong>nslookup</strong> commands to return an IP Address.</p><div class="geshifilter"><blockquote><div class="text geshifilter-text">dig test1.example.com<br>dig t1.example.com<br>dig mx example.com<br>dig mail.example.com<br>nslookup test3.example.com<br>dig www.amazon.com</div></blockquote></div><p>Be aware that using the FQDN for these commands is necessary except for the <strong>nslookup</strong> command as long as the domain and search entries of Example.com are provided in the <strong>/etc/resolv.conf</strong> file. In this case, they probably are not, so just use the FQDNs for all testing in this project.</p><h4>Using the root name servers</h4><p>Notice that the root name servers are given as the authoritative servers for the Amazon.com lookup. But remember you're using the Google public name servers as forwarders. Now comment out the forwarders line in <strong>named.conf</strong> and restart <strong>named</strong>. Run the above commands again to compare the results that are returned. The results should look similar to the ones below in Listing 5.</p><div class="geshifilter"><blockquote><div class="text geshifilter-text"><p># dig www.amazon.com</p><p>; &lt;&lt;&gt;&gt; DiG 9.10.4-P6-RedHat-9.10.4-4.P6.fc25 &lt;&lt;&gt;&gt; www.amazon.com<br>;; global options: +cmd<br>;; Got answer:<br>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 65004<br>;; flags: qr rd ra; QUERY: 1, ANSWER: 6, AUTHORITY: 4, ADDITIONAL: 1</p><p>;; OPT PSEUDOSECTION:<br>; EDNS: version: 0, flags:; udp: 4096<br>;; QUESTION SECTION:<br>;www.amazon.com.                        IN      A</p><p>;; ANSWER SECTION:<br>www.amazon.com.         1800    IN      CNAME   www.cdn.amazon.com.<br>www.cdn.amazon.com.     300     IN      CNAME   d3ag4hukkh62yn.cloudfront.net.<br>d3ag4hukkh62yn.cloudfront.net. 60 IN    A       52.85.147.120<br>d3ag4hukkh62yn.cloudfront.net. 60 IN    A       52.85.147.50<br>d3ag4hukkh62yn.cloudfront.net. 60 IN    A       52.85.147.92<br>d3ag4hukkh62yn.cloudfront.net. 60 IN    A       52.85.147.109</p><p>;; AUTHORITY SECTION:<br>d3ag4hukkh62yn.cloudfront.net. 1831 IN  NS      ns-1144.awsdns-15.org.<br>d3ag4hukkh62yn.cloudfront.net. 1831 IN  NS      ns-130.awsdns-16.com.<br>d3ag4hukkh62yn.cloudfront.net. 1831 IN  NS      ns-2021.awsdns-60.co.uk.<br>d3ag4hukkh62yn.cloudfront.net. 1831 IN  NS      ns-824.awsdns-39.net.</p><p>;; Query time: 3857 msec<br>;; SERVER: 192.168.0.203#53(192.168.0.203)<br>;; WHEN: Mon Mar 13 09:18:30 EDT 2017<br>;; MSG SIZE  rcvd: 306</p></div></blockquote></div><p><small><i>Listing 5: The results of a lookup on <a href="http://www.amazon.com">www.amazon.com</a> have some interesting information including times to live for the various record types.</i></small></p><p>When I did this, the first call to resolve the external address for Amazon took 3857ms while the data was located and returned. Subsequent results to perform the same query was 1ms, which shows the advantage of caching resolver results locally. Notice the numbers 1800, 300, and 60 in the answer section lines and 1831 in authority section lines—these are TTL (Times To Live) in seconds. If you perform the lookup multiple times, these numbers will change, showing the amount of time that the records have remaining to live in local cache.</p><div class="geshifilter"><blockquote><div class="text geshifilter-text">; Authoritative data for example.com  reverse zone<br>;<br>$TTL 1D<br>@   IN SOA  test1.example.com   root.test1.example.com. (<br>2017031501      ; serial<br>1D              ; refresh<br>1H              ; retry<br>1W              ; expire<br>3H )            ; minimum@       IN      NS      epc.example.com.<br>example.com.    IN      NS      epc.example.com.<br>1               IN      PTR     mail.example.com.<br>1               IN      PTR     server.example.com.<br>21              IN      PTR     test1.example.com.<br>22              IN      PTR     test2.example.com.<br>23              IN      PTR     test3.example.com.<br>24              IN      PTR     test4.example.com.<p></p></div></blockquote></div><p><small><i>Listing 6: Use this reverse zone file, example.com.rev, for your name server.</i></small></p><h4>Creating the reverse zone file</h4><p>A reverse zone for your domain will provide the ability to do reverse lookups. Many organizations do not do these internally, but reverse lookups can be helpful in doing problem determination. Many spam fighting configurations, such as SpamAssassin, look for reverse lookups to verify valid email servers.</p><p>Create the reverse zone file, <strong>/var/named/example.com.rev</strong> and add the following contents. Be sure to use an appropriate serial number.</p><p>You could also name your reverse zone file <strong>/var/named/25.168.192.in-addr.arpa</strong>, which follows older conventions. You can actually name it anything you want because you will point to it explicitly in the <strong>named.conf</strong> file, but using one of the two conventions will make it easier for others to follow your work.</p><p>Add the reverse zone to <strong>named.conf</strong>:</p><div class="geshifilter"><blockquote><div class="text geshifilter-text">zone    "25.168.192.in-addr.arpa" IN {<br>type master;<br>file "example.com.rev";<br>};</div></blockquote></div><p><small><i>Listing 7: Adding this stanza to the named.conf file enables reverse lookups.</i></small></p><p>Add the stanza in Listing 7 to the <strong>/etc/named.conf</strong> file to point to the new reverse zone. Now reload <strong>named</strong> and test your reverse zone using the commands in Listing 8. Your results should look similar to those below.</p><div class="geshifilter"><blockquote><div class="text geshifilter-text"><p>​systemctl reload named</p><p># dig -x 192.168.25.23</p><p>; &lt;&lt;&gt;&gt; DiG 9.10.4-P6-RedHat-9.10.4-4.P6.fc25 &lt;&lt;&gt;&gt; -x 192.168.25.23<br>;; global options: +cmd<br>;; Got answer:<br>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 48607<br>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1</p><p>;; OPT PSEUDOSECTION:<br>; EDNS: version: 0, flags:; udp: 4096<br>;; QUESTION SECTION:<br>;23.25.168.192.in-addr.arpa.    IN      PTR</p><p>;; ANSWER SECTION:<br>23.25.168.192.in-addr.arpa. 86400 IN    PTR     test3.example.com.</p><p>;; AUTHORITY SECTION:<br>25.168.192.in-addr.arpa. 86400  IN      NS      epc.example.com.</p><p>;; Query time: 21 msec<br>;; SERVER: 192.168.0.203#53(192.168.0.203)<br>;; WHEN: Wed Mar 15 16:18:59 EDT 2017<br>;; MSG SIZE  rcvd: 112</p></div></blockquote></div><p><small><i>Listing 8: After restarting named you should see results similar to these when you do a reverse lookup on an IP address in the reverse zone.</i></small></p><p>Be sure to test some of the other reverse entries in your network and also try the following as well as other reverse lookups you want to experiment with. The <strong>-x option</strong> means reverse lookup.</p><div class="geshifilter"><blockquote><div class="text geshifilter-text">dig -x 192.168.25.23<br>dig -x 192.168.25.1</div></blockquote></div><p>Note that not all hosts that have entries in the forward zone need to have entries in the reverse zone, but it does make for more consistent results if they do.</p><p>At this point, you have a working name server using BIND. However, external hosts can't yet use this name server because the firewall should not yet be configured to allow DNS requests.</p><h3>Configuring IPTables for DNS</h3><p>You can do this step if you want other hosts on your local network to use your host as their name server.</p><p>The firewall on your test host probably blocks access to your host for name services. IPTables must be configured to allow UDP (User Datagram Protocol) packets inbound on your name server in order for other hosts to use it for name resolution. Use the following commands to add the required entries and save them.</p><p>Add a rule to your IPTables or firewalld firewall that allows incoming packets on port 53 (domain) for UDP and save the new ruleset. Be sure to insert the new rule after the <strong>-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</strong> line, so you will have to count the number of INPUT lines in the filter table in order to do that. The number 7 in the following command means that this rule will be inserted in position number 7 in the existing INPUT rules.</p><pre><small><span class="geshifilter"><code>iptables -t filter -I INPUT 7 -p udp -m conntrack --ctstate NEW -m udp --dport 53 -j ACCEPT</code></span></small></pre><p>You can save your new firewall rules if you like, and you would if this were to be a permanent installation and not a lab project. Then test this from one of your other hosts using the command in Listing 9, below. The <strong>@epc</strong> argument tells the <strong>dig</strong> command to use the specified name server with the hostname <strong>epc</strong>. You should substitute either the IP address of the DNS server you have just created, or a resolvable hostname on your network that points to your new name server. Of course, you could always add that hostname with its IP address to the <strong>/etc/hosts</strong> file of the host you are using for the remote test.</p><div class="geshifilter"><blockquote><div class="text geshifilter-text"><p># dig @epc test1.example.com</p><p>; &lt;&lt;&gt;&gt; DiG 9.10.4-P6-RedHat-9.10.4-4.P6.fc25 &lt;&lt;&gt;&gt; @epc test1.example.com<br>; (1 server found)<br>;; global options: +cmd<br>;; Got answer:<br>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 27957<br>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1</p><p>;; OPT PSEUDOSECTION:<br>; EDNS: version: 0, flags:; udp: 4096<br>;; QUESTION SECTION:<br>;test1.example.com.             IN      A</p><p>;; ANSWER SECTION:<br>test1.example.com.      86400   IN      A       192.168.25.21</p><p>;; AUTHORITY SECTION:<br>example.com.            86400   IN      NS      epc.both.org.</p><p>;; Query time: 0 msec<br>;; SERVER: 192.168.0.203#53(192.168.0.203)<br>;; WHEN: Mon Mar 13 08:45:34 EDT 2017<br>;; MSG SIZE  rcvd: 92</p></div></blockquote></div><p><small><i>Listing 9: Testing the name resolver you have created from a different host on the same network.</i></small></p><h2>Cleanup</h2><p>For cleanup, you should perform the following tasks using the tools appropriate for your distribution. You may just wish to keep this name server for your network if you do not already have one.</p><ol><li>Restore the original <strong>/etc/hosts</strong> file.</li><li>Stop named on the resolver host used for this lab project.</li><li>Disable the named service.</li><li>Delete the zone files.</li><li>Restore the original <strong>named.conf</strong> file.</li><li>Restore the original <strong>resolv.conf</strong> file.</li></ol><h2>Final thoughts</h2><p>The functioning of name services seemed very obscure to me until I actually created a name server for my network using BIND. It is quite straightforward and can improve DNS lookup performance. Having your own name server can also prevent many of the relatively minor yet annoying name service interruptions caused by poorly maintained ISP name servers.</p><p>Note that, even though my little EeePC is running with 100% CPU usage for <a href="mailto:Seti@Home">Seti@Home</a>, it responds extremely quickly to resolver requests. You should be able to try this project on any Linux host you have available with minuscule impact. I hope that many of you will try to set up your own name server and experiment with it. The specifics of your name server installation will depend upon the details of your host and network.</p><h2>Resources</h2><ul><li><a href="https://www.iana.org/">IANA (Internet Assigned Numbers Authority)</a></li><li><a href="http://www.zytrax.com/books/dns/ch8/soa.html">SOA (Start of Authority) record</a></li><li><a href="https://en.wikipedia.org/wiki/List_of_DNS_record_types">List of DNS Record Types</a></li><li><a href="https://blog.dnsimple.com/2015/04/common-dns-records/">Common DNS records and their uses</a></li></ul></div></div></div></div></div></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on May 12, 2020</p><ul class="post__tag"><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/homelab/">Homelab</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/linux/">Linux</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/networking/">Networking</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/projects/">Projects</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/server/">Server</a></li><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/tutorials/">Tutorials</a></li></ul><div class="post__share"></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" class="invert" rel="author">Patrick Szalewicz</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://fachinformatiker.github.io/fachinformatiker.github.io/intrusion-detection-with-git-the-basics.html" class="invert post__nav-link" rel="prev"><span>Previous</span> Intrusion detection with git – the basics</a></div><div class="post__nav-next"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/bsi-cert-bund-reports-howtos-offene-dns-resolver.html" class="invert post__nav-link" rel="next"><span>Next</span> BSI - CERT-Bund Reports: HOWTOs: Offene DNS-Resolver </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2019-12-23T12:24" class="feed__date">December 23, 2019</time></div><h3 class="h1"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/debian-10-set-up-openvpn-server-in-5-minutes.html" class="invert">Debian 10 Set Up OpenVPN Server In 5 Minutes</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2019-07-11T20:59" class="feed__date">July 11, 2019</time></div><h3 class="h1"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-can-i-have-my-own-public-dns-server-like-1111.html" class="invert">How can I have my own Public DNS Server (like 1.1.1.1)?</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2019-07-11T20:57" class="feed__date">July 11, 2019</time></div><h3 class="h1"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/setting-up-a-caching-only-dns-server.html" class="invert">Setting up a Caching-Only DNS Server</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii Static CMS</a></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/scripts.min.js?v=205f40927e4a45297a0b266e50ad78d5"></script><script>var lazyFeaturedImage=function lazyFeaturedImage(){var b=document.querySelectorAll(".hero__image-img");for(var a=0;a<b.length;a++){var c=b[a];c.addEventListener("lazyloaded",function(f){var d=f.target.parentNode;d.classList.add("hero__image--overlay")})}};lazyFeaturedImage();</script></body></html>