<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>sudo - fachinformatiker.app</title><meta name="description" content="Wenn man in der Datei ~alice/.ssh/authorized_keys den mit ssh_keygen erzeugten Public-Key des Users bob einfügt und bob ist in der Gruppe, zu der die Datei ~alice/.ssh/authorized_keys gehört (typischerweise auch alice), dann darf die Datei ~alice/.ssh/authorized_keys keine Gruppen-Schreibrechte haben, sonst kann sich bob nicht passwortlos als alice anmelden. Das ergibt Sinn, man muss aber erst einmal drauf kommen. Am Besten setzt man die Rechte der authorized_keys-Dateien eh auf 600 (chmod 600 ~/.ssh/authorized_keys oder chmod go-rwx ~/.ssh/authorized_keys).Wofür man solches wissen muss? Angenommen, einer Gruppe von Usern soll erlaubt werden, ein ganz konkretes Programm auch als User alice und nicht nur in der Gruppe alice ausführen zu dürfen, dann lässt sich dafür das viel (und oft aus falschen Gründen) gescholtene sudo nutzen, indem in /etc/sudoers mittels sudo visudo%alice ALL=(alice) NOPASSWD:/home/alice/bin/asalice.sheingetragen wird. Damit wird dafür gesorgt, dass Mitglieder der Gruppe alice (%alice) das Programm ~alice/bin/asalice.sh mitsudo -u alice /home/alice/bin/asalice.shausführen dürfen. Dabei muss natürlich darauf geachtet werden, dass in asalice.sh keine Sicherheitslöcher beispielsweise durch less entstehen. (! in less ermöglicht beliebige Shell-Kommandos - dann als User alice)."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://fachinformatiker.github.io/fachinformatiker.github.io/sudo.html"><link rel="alternate" type="application/atom+xml" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://fachinformatiker.github.io/fachinformatiker.github.io/feed.json"><meta property="og:title" content="sudo"><meta property="og:site_name" content="fachinformatiker.app"><meta property="og:description" content="Wenn man in der Datei ~alice/.ssh/authorized_keys den mit ssh_keygen erzeugten Public-Key des Users bob einfügt und bob ist in der Gruppe, zu der die Datei ~alice/.ssh/authorized_keys gehört (typischerweise auch alice), dann darf die Datei ~alice/.ssh/authorized_keys keine Gruppen-Schreibrechte haben, sonst kann sich bob nicht passwortlos als alice anmelden. Das ergibt Sinn, man muss aber erst einmal drauf kommen. Am Besten setzt man die Rechte der authorized_keys-Dateien eh auf 600 (chmod 600 ~/.ssh/authorized_keys oder chmod go-rwx ~/.ssh/authorized_keys).Wofür man solches wissen muss? Angenommen, einer Gruppe von Usern soll erlaubt werden, ein ganz konkretes Programm auch als User alice und nicht nur in der Gruppe alice ausführen zu dürfen, dann lässt sich dafür das viel (und oft aus falschen Gründen) gescholtene sudo nutzen, indem in /etc/sudoers mittels sudo visudo%alice ALL=(alice) NOPASSWD:/home/alice/bin/asalice.sheingetragen wird. Damit wird dafür gesorgt, dass Mitglieder der Gruppe alice (%alice) das Programm ~alice/bin/asalice.sh mitsudo -u alice /home/alice/bin/asalice.shausführen dürfen. Dabei muss natürlich darauf geachtet werden, dass in asalice.sh keine Sicherheitslöcher beispielsweise durch less entstehen. (! in less ermöglicht beliebige Shell-Kommandos - dann als User alice)."><meta property="og:url" content="https://fachinformatiker.github.io/fachinformatiker.github.io/sudo.html"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><style>h1,h2,h3,h4,h5,h6,.btn,[type=button],[type=submit],button,.navbar .navbar__menu li,.navbar_mobile_sidebar .navbar__menu li,.feed__author,.post__tag,.post__share>a span,.post__nav-link>span,.footer{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}body,h1,.h1,blockquote,.search__input,.author__name,.author__info>p,.feed__item h2,.post__nav-link{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/css/style.css?v=cc87cb8806c844f0646558fe70d5c5d1"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://fachinformatiker.github.io/fachinformatiker.github.io/sudo.html"},"headline":"sudo","datePublished":"2019-07-04T13:24","dateModified":"2020-05-12T08:43","description":"<div class=\"mycontent\">\n<p>Wenn man in der Datei <var>~alice/.ssh/authorized_keys</var> den mit <var>ssh_keygen</var> erzeugten Public-Key des Users <var>bob</var> einfügt und <var>bob</var> ist in der Gruppe, zu der die Datei <var>~alice/.ssh/authorized_keys</var> gehört (typischerweise auch <var>alice</var>), dann darf die Datei <var>~alice/.ssh/authorized_keys</var> keine Gruppen-Schreibrechte haben, sonst kann sich <var>bob</var> nicht passwortlos als <var>alice</var> anmelden. Das ergibt Sinn, man muss aber erst einmal drauf kommen. Am Besten setzt man die Rechte der authorized_keys-Dateien eh auf 600 (<var>chmod 600 ~/.ssh/authorized_keys</var> oder <var>chmod go-rwx ~/.ssh/authorized_keys</var>).</p>\n<p>Wofür man solches wissen muss? Angenommen, einer Gruppe von Usern soll erlaubt werden, ein ganz konkretes Programm auch als User <var>alice</var> und nicht nur in der Gruppe <var>alice</var> ausführen zu dürfen, dann lässt sich dafür das viel (und oft aus falschen Gründen) gescholtene <var>sudo</var> nutzen, indem in <var>/etc/sudoers</var> mittels <var>sudo visudo</var></p>\n<pre>%alice ALL=(alice) NOPASSWD:/home/alice/bin/asalice.sh\n</pre>\n<p>eingetragen wird. Damit wird dafür gesorgt, dass Mitglieder der Gruppe alice (<var>%alice</var>) das Programm <var>~alice/bin/asalice.sh</var> mit</p>\n<pre>sudo -u alice /home/alice/bin/asalice.sh\n</pre>\n<p>ausführen dürfen. Dabei muss natürlich darauf geachtet werden, dass in <var>asalice.sh</var> keine Sicherheitslöcher beispielsweise durch <var>less</var> entstehen. (<var>!</var> in <var>less</var> ermöglicht beliebige Shell-Kommandos - dann als User <var>alice</var>).</p>\n","author":{"@type":"Person","name":"Patrick Szalewicz"},"publisher":{"@type":"Organization","name":"Patrick Szalewicz"}}</script><script src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/ls.parent-fit.min.js?v=f8467455ea5c88e3e51a4f212d2632bd"></script><script async src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/lazysizes.min.js?v=6a69d476c93de2b78a72acb259abccea"></script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://fachinformatiker.github.io/fachinformatiker.github.io/">fachinformatiker.app</a><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><form action="https://fachinformatiker.github.io/fachinformatiker.github.io/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="search..." autofocus="autofocus"></form><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2019-07-04T13:24">July 4, 2019</time></div><h1>sudo</h1><div class="post__meta post__meta--author"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" class="feed__author invert">Patrick Szalewicz</a></div></div></header></div><div class="wrapper post__entry"><div class="mycontent"><p>Wenn man in der Datei <var>~alice/.ssh/authorized_keys</var> den mit <var>ssh_keygen</var> erzeugten Public-Key des Users <var>bob</var> einfügt und <var>bob</var> ist in der Gruppe, zu der die Datei <var>~alice/.ssh/authorized_keys</var> gehört (typischerweise auch <var>alice</var>), dann darf die Datei <var>~alice/.ssh/authorized_keys</var> keine Gruppen-Schreibrechte haben, sonst kann sich <var>bob</var> nicht passwortlos als <var>alice</var> anmelden. Das ergibt Sinn, man muss aber erst einmal drauf kommen. Am Besten setzt man die Rechte der authorized_keys-Dateien eh auf 600 (<var>chmod 600 ~/.ssh/authorized_keys</var> oder <var>chmod go-rwx ~/.ssh/authorized_keys</var>).</p><p>Wofür man solches wissen muss? Angenommen, einer Gruppe von Usern soll erlaubt werden, ein ganz konkretes Programm auch als User <var>alice</var> und nicht nur in der Gruppe <var>alice</var> ausführen zu dürfen, dann lässt sich dafür das viel (und oft aus falschen Gründen) gescholtene <var>sudo</var> nutzen, indem in <var>/etc/sudoers</var> mittels <var>sudo visudo</var></p><pre>%alice ALL=(alice) NOPASSWD:/home/alice/bin/asalice.sh
</pre><p>eingetragen wird. Damit wird dafür gesorgt, dass Mitglieder der Gruppe alice (<var>%alice</var>) das Programm <var>~alice/bin/asalice.sh</var> mit</p><pre>sudo -u alice /home/alice/bin/asalice.sh
</pre><p>ausführen dürfen. Dabei muss natürlich darauf geachtet werden, dass in <var>asalice.sh</var> keine Sicherheitslöcher beispielsweise durch <var>less</var> entstehen. (<var>!</var> in <var>less</var> ermöglicht beliebige Shell-Kommandos - dann als User <var>alice</var>).</p><p>So vermeidet man, dass einer Gruppe von Usern für einzelne Aufgaben gleich der gesamte User-Account per ssh freigegeben werden muss, und ermöglicht sehr feingranulare Administrationsrechte, so dass passwortlos und daher automatisierbar, Skripte unter dem User <var>alice</var> ausgeführt werden können.</p><p>Wenn der User <var>bob</var> Ubuntu-typisch auch noch in der Gruppe <var>sudo</var> ist und dadurch Root-Rechte hat, muss der spezifischere Eintrag (<var>%alice</var>) nach dem allgemeineren (<var>%sudo</var>) stehen, sonst funktioniert der Aufruf nicht passwortlos.</p><p>Mit der Kombination <var>ssh</var>, <var>git</var>, <var>sudo</var>, Gruppen und Usern lassen sich recht komfortable und dennoch sichere Administrationskonzepte bauen.</p><p>Ein ähnliches Ergebnis erzielt man, indem in der Datei <var>authorized_keys</var> vor dem jeweiligen Schlüssel, der mit <var>ssh-rsa</var> beginnt,</p><pre>command="auszufuehrendesprogramm"
</pre><p>in der gleichen Zeile eingetragen wird. Soll z.B. wieder <var>bob</var> passwortlos auf dem Server - diesmal als <var>claire</var> - nur ein spezielles Programm auführen dürfen, sieht das in der <var>authorized_keys</var>-Datei bei <var>claire</var> etwa so aus:</p><pre>command="/home/claire/bin/asclaire_via_ssh.sh" ssh-rsa AAAA ....
</pre><p>Das Programm <code>asclaire_via_ssh.sh</code> wird dasjenige sein, das in jedem Falle ausgeführt wird, egal welches Programm als Argument an <var>ssh</var> übergeben wird. In dem Skript kann dann über die Variable <var>SSH_ORIGINAL_COMMAND</var> unterschieden werden, was konkret zu tun ist.</p><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment">#name: asclaire_via_ssh.sh</span>
[ <span class="hljs-string">"<span class="hljs-variable">$SSH_ORIGINAL_COMMAND</span>"</span> == <span class="hljs-string">'list'</span> ] &amp;&amp; /home/claire/bin/list
[ <span class="hljs-string">"<span class="hljs-variable">$SSH_ORIGINAL_COMMAND</span>"</span> == <span class="hljs-string">'depl'</span> ] &amp;&amp; /home/claire/bin/depl
</code></pre><p>So kann nun <var>bob</var> per <var>ssh</var> das Programm <code>asclaire_via_ssh.sh</code> von seinem Account - auch von seinem lokalen Rechner aus, wenn die Public-Key Infrastruktur entsprechend eingerichtet ist - aufrufen, indem er scheinbar <code>list</code> oder <code>depl</code> aufruft:</p><pre><code class="bash hljs">ssh claire@server list
<span class="hljs-comment">#hello bob incarnated as claire</span>
<span class="hljs-comment">#this is a list of available commands</span>
list
depl
</code></pre><p>Auf den Namen als Remote-User lässt sich (meines Wissens nach) nicht direkt zugreifen. Jedoch lässt sich vermittels</p><pre><code class="shell hljs">command="/home/claire/bin/sshasclaire.sh",\
environment="REMOTE_USER=bob" ssh-rsa AAAA ....
</code></pre><p>eine passende Umgebung aufsetzen, wenn in der Konfiguration in <code>/etc/ssh/sshd_conf</code> die Zeile</p><pre><code class="shell hljs">PermitUserEnvironment yes
</code></pre><p>eingetragen ist.</p></div></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on May 12, 2020</p><ul class="post__tag"><li><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/linux/">Linux</a></li></ul><div class="post__share"></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/authors/patrick-szalewicz/" class="invert" rel="author">Patrick Szalewicz</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://fachinformatiker.github.io/fachinformatiker.github.io/passwoerter.html" class="invert post__nav-link" rel="prev"><span>Previous</span> Passwörter</a></div><div class="post__nav-next"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-set-up-your-own-private-rtmp-server-using-nginx.html" class="invert post__nav-link" rel="next"><span>Next</span> How to set up your own private RTMP server using nginx </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2020-02-01T12:03" class="feed__date">February 1, 2020</time></div><h3 class="h1"><a href="https://fachinformatiker.github.io/fachinformatiker.github.io/how-to-create-a-sudo-user.html" class="invert">How To Create a Sudo User</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii Static CMS</a></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://fachinformatiker.github.io/fachinformatiker.github.io/assets/js/scripts.min.js?v=205f40927e4a45297a0b266e50ad78d5"></script><script>var lazyFeaturedImage=function lazyFeaturedImage(){var b=document.querySelectorAll(".hero__image-img");for(var a=0;a<b.length;a++){var c=b[a];c.addEventListener("lazyloaded",function(f){var d=f.target.parentNode;d.classList.add("hero__image--overlay")})}};lazyFeaturedImage();</script></body></html>